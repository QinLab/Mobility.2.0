t2_d <- data.frame(rownames(t2_d),t2_d[,1],t2_d[,2])
names(t2_d) <- c('region','noTC','Tc')
sum_tc <- binconf(x=t2$Tc,n = t2$noTC+t2$Tc,method = 'exact')
sum_tc_d <- binconf(x=t2_d$Tc,n = t2_d$noTC+t2_d$Tc,method = 'exact')
errbar(x = 1:4,y = sum_tc[,1],yplus = sum_tc[,2],yminus = sum_tc[,3],
xaxt='n',bty='n',ylab = 'proportion',col='blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.3,y = sum_tc_d[,1],yplus = sum_tc_d[,2],yminus = sum_tc_d[,3],
xaxt='n',bty='n',ylab = 'proportion',col='red3',errbar.col = 'red3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t2$region)
legend('topright',legend = c('with time change','and >5,000 deaths'),bty='n',
lwd=2,col=c('blue3','red3'),seg.len = .5,cex=.7)
# binconf(x=sum(t2$Tc),n = sum(t2$noTC+t2$Tc),method = 'exact')
print('overall')
binconf(x=sum(AG$Tc),n = nrow(AG),method = 'exact')
# quantile(AG$TotalDeath,c(.5,.25,.75))
f <-  AG$TotalDeath>5e3
print('with more than 5e3')
binconf(x=sum(AG$Tc[f]),n = sum(f),method = 'exact')
View(t2)
View(t2_d)
View(t2)
View(t2_d)
View(t2)
View(t2_d)
View(t2)
t1 <- table(AG$region,AG$Tc)
t2 <- (table(AG$region2,AG$Tc))
t2 <- data.frame(rownames(t2),t2[,1],t2[,2])
names(t2) <- c('region','noTC','Tc')
AG$TotalDeath <- colSums(inputs$D[,2:(nrow(AG)+1)])
f_d <- which(AG$TotalDeath > 5e3)
t2_d <- (table(AG$region2[f_d],AG$Tc[f_d]))
t2_d <- data.frame(rownames(t2_d),t2_d[,1],t2_d[,2])
names(t2_d) <- c('region','noTC','Tc')
sum_tc <- binconf(x=t2$Tc,n = t2$noTC+t2$Tc,method = 'exact')
sum_tc_d <- binconf(x=t2_d$Tc,n = t2_d$noTC+t2_d$Tc,method = 'exact')
errbar(x = 1:4,y = sum_tc[,1],yplus = sum_tc[,2],yminus = sum_tc[,3],
xaxt='n',bty='n',ylab = 'proportion',col='blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.3,y = sum_tc_d[,1],yplus = sum_tc_d[,2],yminus = sum_tc_d[,3],
xaxt='n',bty='n',ylab = 'proportion with time change',col='red3',errbar.col = 'red3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t2$region)
legend('topright',legend = c('across all','where >5,000 deaths'),bty='n',
lwd=2,col=c('blue3','red3'),seg.len = .5,cex=.7)
# binconf(x=sum(t2$Tc),n = sum(t2$noTC+t2$Tc),method = 'exact')
print('overall')
binconf(x=sum(AG$Tc),n = nrow(AG),method = 'exact')
# quantile(AG$TotalDeath,c(.5,.25,.75))
f <-  AG$TotalDeath>5e3
print('with more than 5e3')
binconf(x=sum(AG$Tc[f]),n = sum(f),method = 'exact')
t1 <- table(AG$region,AG$Tc)
t2 <- (table(AG$region2,AG$Tc))
t2 <- data.frame(rownames(t2),t2[,1],t2[,2])
names(t2) <- c('region','noTC','Tc')
AG$TotalDeath <- colSums(inputs$D[,2:(nrow(AG)+1)])
f_d <- which(AG$TotalDeath > 5e3)
t2_d <- (table(AG$region2[f_d],AG$Tc[f_d]))
t2_d <- data.frame(rownames(t2_d),t2_d[,1],t2_d[,2])
names(t2_d) <- c('region','noTC','Tc')
sum_tc <- binconf(x=t2$Tc,n = t2$noTC+t2$Tc,method = 'exact')
sum_tc_d <- binconf(x=t2_d$Tc,n = t2_d$noTC+t2_d$Tc,method = 'exact')
errbar(x = 1:4,y = sum_tc[,1],yplus = sum_tc[,2],yminus = sum_tc[,3],
xaxt='n',bty='n',ylab = 'proportion with time change',col='blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.3,y = sum_tc_d[,1],yplus = sum_tc_d[,2],yminus = sum_tc_d[,3],
xaxt='n',bty='n',ylab = '',col='red3',errbar.col = 'red3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t2$region)
legend('topright',legend = c('across all','where >5,000 deaths'),bty='n',
lwd=2,col=c('blue3','red3'),seg.len = .5,cex=.7)
# binconf(x=sum(t2$Tc),n = sum(t2$noTC+t2$Tc),method = 'exact')
print('overall')
binconf(x=sum(AG$Tc),n = nrow(AG),method = 'exact')
# quantile(AG$TotalDeath,c(.5,.25,.75))
f <-  AG$TotalDeath>5e3
print('with more than 5e3')
binconf(x=sum(AG$Tc[f]),n = sum(f),method = 'exact')
t1 <- table(AG$region,AG$Tc)
t2 <- (table(AG$region2,AG$Tc))
t2 <- data.frame(rownames(t2),t2[,1],t2[,2])
names(t2) <- c('region','noTC','Tc')
AG$TotalDeath <- colSums(inputs$D[,2:(nrow(AG)+1)])
f_d <- which(AG$TotalDeath > 5e3)
t2_d <- (table(AG$region2[f_d],AG$Tc[f_d]))
t2_d <- data.frame(rownames(t2_d),t2_d[,1],t2_d[,2])
names(t2_d) <- c('region','noTC','Tc')
sum_tc <- binconf(x=t2$Tc,n = t2$noTC+t2$Tc,method = 'exact')
sum_tc_d <- binconf(x=t2_d$Tc,n = t2_d$noTC+t2_d$Tc,method = 'exact')
errbar(x = 1:4,y = sum_tc[,1],yplus = sum_tc[,2],yminus = sum_tc[,3],
xaxt='n',bty='n',ylab = 'proportion with time change',col='blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.3,y = sum_tc_d[,1],yplus = sum_tc_d[,2],yminus = sum_tc_d[,3],
xaxt='n',bty='n',ylab = '',col='red3',errbar.col = 'red3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t2$region)
legend('bottompright',legend = c('across all','where >5,000 deaths'),bty='n',
lwd=2,col=c('blue3','red3'),seg.len = .5,cex=.7)
t1 <- table(AG$region,AG$Tc)
t2 <- (table(AG$region2,AG$Tc))
t2 <- data.frame(rownames(t2),t2[,1],t2[,2])
names(t2) <- c('region','noTC','Tc')
AG$TotalDeath <- colSums(inputs$D[,2:(nrow(AG)+1)])
f_d <- which(AG$TotalDeath > 5e3)
t2_d <- (table(AG$region2[f_d],AG$Tc[f_d]))
t2_d <- data.frame(rownames(t2_d),t2_d[,1],t2_d[,2])
names(t2_d) <- c('region','noTC','Tc')
sum_tc <- binconf(x=t2$Tc,n = t2$noTC+t2$Tc,method = 'exact')
sum_tc_d <- binconf(x=t2_d$Tc,n = t2_d$noTC+t2_d$Tc,method = 'exact')
errbar(x = 1:4,y = sum_tc[,1],yplus = sum_tc[,2],yminus = sum_tc[,3],
xaxt='n',bty='n',ylab = 'proportion with time change',col='blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.3,y = sum_tc_d[,1],yplus = sum_tc_d[,2],yminus = sum_tc_d[,3],
xaxt='n',bty='n',ylab = '',col='red3',errbar.col = 'red3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t2$region)
legend('bottomright',legend = c('across all','where >5,000 deaths'),bty='n',
lwd=2,col=c('blue3','red3'),seg.len = .5,cex=.7)
# binconf(x=sum(t2$Tc),n = sum(t2$noTC+t2$Tc),method = 'exact')
print('overall')
binconf(x=sum(AG$Tc),n = nrow(AG),method = 'exact')
# quantile(AG$TotalDeath,c(.5,.25,.75))
f <-  AG$TotalDeath>5e3
print('with more than 5e3')
binconf(x=sum(AG$Tc[f]),n = sum(f),method = 'exact')
t2 <-aggregate(AG$Rsq,by=list(AG$region2),quantile,c(.5,.025,.975))
t2 <- data.frame(t2[[1]],t2[[2]][,1],t2[[2]][,2],t2[[2]][,3])
names(t2) <- c('region','med','low','up')
f_tc <- which(AG$Tc)
f_d <- which(AG$Tc & AG$TotalDeath > 5e3) #quantile(AG$TotalDeath,c(.5)))
t2_tc <-aggregate(AG$Rsq[f_tc],by=list(AG$region2[f_tc]),quantile,c(.5,.025,.975))
t2_tc <- data.frame(t2_tc[[1]],t2_tc[[2]][,1],t2_tc[[2]][,2],t2_tc[[2]][,3])
names(t2_tc) <- c('region','med','low','up')
t2_d <-aggregate(AG$Rsq[f_d],by=list(AG$region2[f_d]),quantile,c(.5,.025,.975))
t2_d <- data.frame(t2_d[[1]],t2_d[[2]][,1],t2_d[[2]][,2],t2_d[[2]][,3])
names(t2_d) <- c('region','med','low','up')
errbar(x = 1:4,y = t2[,2],yplus = t2[,3],yminus = t2[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.2,y = t2_tc[,2],yplus = t2_tc[,3],yminus = t2_tc[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',col = 'blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.5,4.5),ylim = c(0,1),add=TRUE)
errbar(x = 1:4+.4,y = t2_d[,2],yplus = t2_d[,3],yminus = t2_d[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',col = 'red3',errbar.col = 'red3',
xlab = '',xlim = c(0.5,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t2$region)
legend('topright',legend = c('all','with time change','and >5,000 deaths'),bty='n',
lwd=2,col=c('black','blue3','red3'),seg.len = .5,cex=.7)
quantile(AG$Rsq,c(.5,.025,.975))
hist(AG$Rsq)
# only with TC
quantile(AG$Rsq[f_tc],c(.5,.025,.975))
hist(AG$Rsq[f_tc])
# with more deaths
quantile(AG$Rsq[f_d],c(.5,.025,.975))
hist(AG$Rsq[f_d])
layout(matrix(1:2,1,2))
##################################
errbar(x = 1:4,y = sum_tc[,1],yplus = sum_tc[,2],yminus = sum_tc[,3],
xaxt='n',bty='n',ylab = 'proportion with time change',col='blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.3,y = sum_tc_d[,1],yplus = sum_tc_d[,2],yminus = sum_tc_d[,3],
xaxt='n',bty='n',ylab = '',col='red3',errbar.col = 'red3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t2$region)
legend('bottomright',legend = c('across all','where >5,000 deaths'),bty='n',
lwd=2,col=c('blue3','red3'),seg.len = .5,cex=.7)
##################################
errbar(x = 1:4,y = t3[,2],yplus = t3[,3],yminus = t3[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
library(knitr)
library(Hmisc)
library(EpiEstim)
library(zoo)
library(latex2exp)
opts_chunk$set(collapse = TRUE)
opts_chunk$set(fig.path='../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/figs/', fig.keep='high',
dev=c('png'), fig.width=6, fig.height=6, cache=FALSE,
tidy=FALSE, warning=FALSE, fig.show="asis"
)
inputs<- readRDS(file=
'../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/inputs.rds')
names(inputs)
data_stream <- names(inputs$M_process_mat )
DICs1 <- data.frame(country = names(inputs$D)[-1],matrix(NA,1,length(data_stream)))
names(DICs1)[-1] <- data_stream
DICs2 <- DICs1
names(DICs2)[-1] <- paste0(data_stream,'_tc')
si=2
for (Mdata in data_stream){
res_m1 <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
res_m2 <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_tD_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
country_infer <- (res_m1$country)
for (i in 1:length(country_infer)){
fc <- which(names(DICs1) %in% Mdata)
fr <- which(DICs1$country %in% country_infer[i])
DICs1[fr,fc] <- round(res_m1$resMCMC$DIC[i])
DICs2[fr,fc] <- round(res_m2$resMCMC$DIC[i])
}
}
DICs3 <- merge(x = DICs1,y = DICs2,by = 'country')
DICs4 <- DICs3[,1:6]
names(DICs4)[-1] <- c('best','value','best_Tc','value','diff')
for (i in 1:nrow(DICs4)){
f <- which(DICs1[i,2:ncol(DICs1)] %in% min(DICs1[i,2:ncol(DICs1)],na.rm=TRUE))
if(length(f)>1) f <- tail(f,1)
DICs4[i,2] <- names(DICs1)[f+1]
DICs4[i,3] <- min(DICs1[i,2:ncol(DICs1)],na.rm=TRUE)
f <- which(DICs2[i,2:ncol(DICs1)] %in% min(DICs2[i,2:ncol(DICs1)],na.rm=TRUE))
if(length(f)>1) f <- tail(f,1)
DICs4[i,4] <- names(DICs2)[f+1]
DICs4[i,5] <- min(DICs2[i,2:ncol(DICs2)],na.rm=TRUE)
}
DICs4[,6] <- DICs4[,3]-DICs4[,5]
write.csv(DICs1,file = 'DICs1.csv')
write.csv(DICs2,file = 'DICs2.csv')
write.csv(DICs3,file = 'DICs3.csv')
write.csv(DICs4,file = 'DICs4.csv')
AG <- data.frame(country = as.character(DICs3$country),AG = DICs3$AG,AGt = DICs3$AG_tc)
AG$diff <- AG$AG-AG$AGt
AG$Tc <- AG$diff>10
## WHO region
write.csv(AG,'AG.csv')
AG <- read.csv(file = 'AG_with_region.csv')
AG[,2] <- as.character(AG[,2])
AG[,3] <- as.character(AG[,3])
AG[,4] <- as.character(AG[,4])
AGcorr <- readRDS('../Figure1/AG_corr.rds')
AG$Rsq <- NA
layout(matrix(1:4,2,2))
for (i in 1:nrow(AG)){
x <- AGcorr[[1]][,i+1]
y <- AGcorr[[2]][,i+1]
plot(x,y,main = AG$country[i])
m <- summary(lm(y~x))
AG$Rsq[i] <- m$adj.r.squared
}
xt <-  as.vector(as.matrix(AGcorr[[1]][,-1]))
yt <- as.vector(as.matrix(AGcorr[[2]][,-1]))
plot(xt,yt)
m <- summary(lm(yt~xt))
m
t1 <- table(AG$region,AG$Tc)
t2 <- (table(AG$region2,AG$Tc))
t2 <- data.frame(rownames(t2),t2[,1],t2[,2])
names(t2) <- c('region','noTC','Tc')
AG$TotalDeath <- colSums(inputs$D[,2:(nrow(AG)+1)])
f_d <- which(AG$TotalDeath > 5e3)
t2_d <- (table(AG$region2[f_d],AG$Tc[f_d]))
t2_d <- data.frame(rownames(t2_d),t2_d[,1],t2_d[,2])
names(t2_d) <- c('region','noTC','Tc')
sum_tc <- binconf(x=t2$Tc,n = t2$noTC+t2$Tc,method = 'exact')
sum_tc_d <- binconf(x=t2_d$Tc,n = t2_d$noTC+t2_d$Tc,method = 'exact')
errbar(x = 1:4,y = sum_tc[,1],yplus = sum_tc[,2],yminus = sum_tc[,3],
xaxt='n',bty='n',ylab = 'proportion with time change',col='blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.3,y = sum_tc_d[,1],yplus = sum_tc_d[,2],yminus = sum_tc_d[,3],
xaxt='n',bty='n',ylab = '',col='red3',errbar.col = 'red3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t2$region)
legend('bottomright',legend = c('across all','where >5,000 deaths'),bty='n',
lwd=2,col=c('blue3','red3'),seg.len = .5,cex=.7)
# binconf(x=sum(t2$Tc),n = sum(t2$noTC+t2$Tc),method = 'exact')
print('overall')
binconf(x=sum(AG$Tc),n = nrow(AG),method = 'exact')
# quantile(AG$TotalDeath,c(.5,.25,.75))
f <-  AG$TotalDeath>5e3
print('with more than 5e3')
binconf(x=sum(AG$Tc[f]),n = sum(f),method = 'exact')
t3 <-aggregate(AG$Rsq,by=list(AG$region2),quantile,c(.5,.025,.975))
t3 <- data.frame(t3[[1]],t3[[2]][,1],t3[[2]][,2],t3[[2]][,3])
names(t3) <- c('region','med','low','up')
f_tc <- which(AG$Tc)
f_d <- which(AG$Tc & AG$TotalDeath > 5e3) #quantile(AG$TotalDeath,c(.5)))
t3_tc <-aggregate(AG$Rsq[f_tc],by=list(AG$region2[f_tc]),quantile,c(.5,.025,.975))
t3_tc <- data.frame(t3_tc[[1]],t3_tc[[2]][,1],t3_tc[[2]][,2],t3_tc[[2]][,3])
names(t3_tc) <- c('region','med','low','up')
t3_d <-aggregate(AG$Rsq[f_d],by=list(AG$region2[f_d]),quantile,c(.5,.025,.975))
t3_d <- data.frame(t3_d[[1]],t3_d[[2]][,1],t3_d[[2]][,2],t3_d[[2]][,3])
names(t3_d) <- c('region','med','low','up')
errbar(x = 1:4,y = t3[,2],yplus = t3[,3],yminus = t3[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.2,y = t3_tc[,2],yplus = t3_tc[,3],yminus = t3_tc[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',col = 'blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.5,4.5),ylim = c(0,1),add=TRUE)
errbar(x = 1:4+.4,y = t3_d[,2],yplus = t3_d[,3],yminus = t3_d[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',col = 'red3',errbar.col = 'red3',
xlab = '',xlim = c(0.5,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t3$region)
legend('bottomright',legend = c('all','with time change','and >5,000 deaths'),bty='n',
lwd=2,col=c('black','blue3','red3'),seg.len = .5,cex=.7)
quantile(AG$Rsq,c(.5,.025,.975))
hist(AG$Rsq)
# only with TC
quantile(AG$Rsq[f_tc],c(.5,.025,.975))
hist(AG$Rsq[f_tc])
# with more deaths
quantile(AG$Rsq[f_d],c(.5,.025,.975))
hist(AG$Rsq[f_d])
layout(matrix(1:2,1,2))
##################################
errbar(x = 1:4,y = sum_tc[,1],yplus = sum_tc[,2],yminus = sum_tc[,3],
xaxt='n',bty='n',ylab = 'proportion with time change',col='blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.3,y = sum_tc_d[,1],yplus = sum_tc_d[,2],yminus = sum_tc_d[,3],
xaxt='n',bty='n',ylab = '',col='red3',errbar.col = 'red3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t2$region)
legend('bottomright',legend = c('across all','where >5,000 deaths'),bty='n',
lwd=2,col=c('blue3','red3'),seg.len = .5,cex=.7)
##################################
errbar(x = 1:4,y = t3[,2],yplus = t3[,3],yminus = t3[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.2,y = t3_tc[,2],yplus = t3_tc[,3],yminus = t3_tc[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',col = 'blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.5,4.5),ylim = c(0,1),add=TRUE)
errbar(x = 1:4+.4,y = t3_d[,2],yplus = t3_d[,3],yminus = t3_d[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',col = 'red3',errbar.col = 'red3',
xlab = '',xlim = c(0.5,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t3$region)
legend('bottomright',legend = c('all','with time change','and >5,000 deaths'),bty='n',
lwd=2,col=c('black','blue3','red3'),seg.len = .5,cex=.7)
layout(matrix(1:2,1,2))
##################################
errbar(x = 1:4,y = sum_tc[,1],yplus = sum_tc[,2],yminus = sum_tc[,3],
xaxt='n',bty='n',ylab = 'proportion with time change',col='blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.3,y = sum_tc_d[,1],yplus = sum_tc_d[,2],yminus = sum_tc_d[,3],
xaxt='n',bty='n',ylab = '',col='red3',errbar.col = 'red3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t2$region,las=2)
legend('bottomright',legend = c('across all','where >5,000 deaths'),bty='n',
lwd=2,col=c('blue3','red3'),seg.len = .5,cex=.7)
##################################
errbar(x = 1:4,y = t3[,2],yplus = t3[,3],yminus = t3[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.2,y = t3_tc[,2],yplus = t3_tc[,3],yminus = t3_tc[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',col = 'blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.5,4.5),ylim = c(0,1),add=TRUE)
errbar(x = 1:4+.4,y = t3_d[,2],yplus = t3_d[,3],yminus = t3_d[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',col = 'red3',errbar.col = 'red3',
xlab = '',xlim = c(0.5,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t3$region,las=2)
legend('bottomright',legend = c('all','with time change','and >5,000 deaths'),bty='n',
lwd=2,col=c('black','blue3','red3'),seg.len = .5,cex=.7)
layout(matrix(1:2,1,2))
# par(mar = c(bottom, left, top, right)), default  c(5.1, 4.1, 4.1, 2.1).
par(mar = c(6,3,2,1))
##################################
errbar(x = 1:4,y = sum_tc[,1],yplus = sum_tc[,2],yminus = sum_tc[,3],
xaxt='n',bty='n',ylab = 'proportion with time change',col='blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.3,y = sum_tc_d[,1],yplus = sum_tc_d[,2],yminus = sum_tc_d[,3],
xaxt='n',bty='n',ylab = '',col='red3',errbar.col = 'red3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t2$region,las=2)
legend('bottomright',legend = c('across all','where >5,000 deaths'),bty='n',
lwd=2,col=c('blue3','red3'),seg.len = .5,cex=.7)
##################################
errbar(x = 1:4,y = t3[,2],yplus = t3[,3],yminus = t3[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.2,y = t3_tc[,2],yplus = t3_tc[,3],yminus = t3_tc[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',col = 'blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.5,4.5),ylim = c(0,1),add=TRUE)
errbar(x = 1:4+.4,y = t3_d[,2],yplus = t3_d[,3],yminus = t3_d[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',col = 'red3',errbar.col = 'red3',
xlab = '',xlim = c(0.5,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t3$region,las=2)
legend('bottomright',legend = c('all','with time change','and >5,000 deaths'),bty='n',
lwd=2,col=c('black','blue3','red3'),seg.len = .5,cex=.7)
layout(matrix(1:2,1,2))
# par(mar = c(bottom, left, top, right)), default  c(5.1, 4.1, 4.1, 2.1).
par(mar = c(6,4,2,2))
##################################
errbar(x = 1:4,y = sum_tc[,1],yplus = sum_tc[,2],yminus = sum_tc[,3],
xaxt='n',bty='n',ylab = 'proportion with time change',col='blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.3,y = sum_tc_d[,1],yplus = sum_tc_d[,2],yminus = sum_tc_d[,3],
xaxt='n',bty='n',ylab = '',col='red3',errbar.col = 'red3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t2$region,las=2)
legend('bottomright',legend = c('across all','where >5,000 deaths'),bty='n',
lwd=2,col=c('blue3','red3'),seg.len = .5,cex=.7)
##################################
errbar(x = 1:4,y = t3[,2],yplus = t3[,3],yminus = t3[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.2,y = t3_tc[,2],yplus = t3_tc[,3],yminus = t3_tc[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',col = 'blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.5,4.5),ylim = c(0,1),add=TRUE)
errbar(x = 1:4+.4,y = t3_d[,2],yplus = t3_d[,3],yminus = t3_d[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',col = 'red3',errbar.col = 'red3',
xlab = '',xlim = c(0.5,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t3$region,las=2)
legend('bottomright',legend = c('all','with time change','and >5,000 deaths'),bty='n',
lwd=2,col=c('black','blue3','red3'),seg.len = .5,cex=.7)
AG <- data.frame(country = as.character(DICs3$country),AG = DICs3$AG,AGt = DICs3$AG_tc)
AG$diff <- AG$AG-AG$AGt
AG$Tc <- AG$diff>10
## WHO region
write.csv(AG,'AG.csv')
AG <- read.csv(file = 'AG_with_region.csv')
AG[,2] <- as.character(AG[,2])
AG[,3] <- as.character(AG[,3])
AG[,4] <- as.character(AG[,4])
AGcorr <- readRDS('../Figure1/AG_corr.rds')
AG$Rsq <- NA
layout(matrix(1:4,2,2))
for (i in 1:nrow(AG)){
x <- AGcorr[[1]][,i+1]
y <- AGcorr[[2]][,i+1]
plot(x,y,main = AG$country[i])
m <- summary(lm(y~x))
AG$Rsq[i] <- m$adj.r.squared
}
xt <-  as.vector(as.matrix(AGcorr[[1]][,-1]))
yt <- as.vector(as.matrix(AGcorr[[2]][,-1]))
plot(xt,yt)
m <- summary(lm(yt~xt))
m
t1 <- table(AG$region,AG$Tc)
t2 <- (table(AG$region2,AG$Tc))
t2 <- data.frame(rownames(t2),t2[,1],t2[,2])
names(t2) <- c('region','noTC','Tc')
AG$TotalDeath <- colSums(inputs$D[,2:(nrow(AG)+1)])
f_d <- which(AG$TotalDeath > 5e3)
t2_d <- (table(AG$region2[f_d],AG$Tc[f_d]))
t2_d <- data.frame(rownames(t2_d),t2_d[,1],t2_d[,2])
names(t2_d) <- c('region','noTC','Tc')
sum_tc <- binconf(x=t2$Tc,n = t2$noTC+t2$Tc,method = 'exact')
sum_tc_d <- binconf(x=t2_d$Tc,n = t2_d$noTC+t2_d$Tc,method = 'exact')
errbar(x = 1:4,y = sum_tc[,1],yplus = sum_tc[,2],yminus = sum_tc[,3],
xaxt='n',bty='n',ylab = 'proportion with time change',col='blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.3,y = sum_tc_d[,1],yplus = sum_tc_d[,2],yminus = sum_tc_d[,3],
xaxt='n',bty='n',ylab = '',col='red3',errbar.col = 'red3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t2$region)
legend('bottomright',legend = c('across all','where >5,000 deaths'),bty='n',
lwd=2,col=c('blue3','red3'),seg.len = .5,cex=.7)
# binconf(x=sum(t2$Tc),n = sum(t2$noTC+t2$Tc),method = 'exact')
print('overall')
binconf(x=sum(AG$Tc),n = nrow(AG),method = 'exact')
# quantile(AG$TotalDeath,c(.5,.25,.75))
f <-  AG$TotalDeath>5e3
print('with more than 5e3')
binconf(x=sum(AG$Tc[f]),n = sum(f),method = 'exact')
t3 <-aggregate(AG$Rsq,by=list(AG$region2),quantile,c(.5,.025,.975))
t3 <- data.frame(t3[[1]],t3[[2]][,1],t3[[2]][,2],t3[[2]][,3])
names(t3) <- c('region','med','low','up')
f_tc <- which(AG$Tc)
f_d <- which(AG$Tc & AG$TotalDeath > 5e3) #quantile(AG$TotalDeath,c(.5)))
t3_tc <-aggregate(AG$Rsq[f_tc],by=list(AG$region2[f_tc]),quantile,c(.5,.025,.975))
t3_tc <- data.frame(t3_tc[[1]],t3_tc[[2]][,1],t3_tc[[2]][,2],t3_tc[[2]][,3])
names(t3_tc) <- c('region','med','low','up')
t3_d <-aggregate(AG$Rsq[f_d],by=list(AG$region2[f_d]),quantile,c(.5,.025,.975))
t3_d <- data.frame(t3_d[[1]],t3_d[[2]][,1],t3_d[[2]][,2],t3_d[[2]][,3])
names(t3_d) <- c('region','med','low','up')
errbar(x = 1:4,y = t3[,2],yplus = t3[,3],yminus = t3[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.2,y = t3_tc[,2],yplus = t3_tc[,3],yminus = t3_tc[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',col = 'blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.5,4.5),ylim = c(0,1),add=TRUE)
errbar(x = 1:4+.4,y = t3_d[,2],yplus = t3_d[,3],yminus = t3_d[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',col = 'red3',errbar.col = 'red3',
xlab = '',xlim = c(0.5,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t3$region)
legend('bottomright',legend = c('all','with time change','and >5,000 deaths'),bty='n',
lwd=2,col=c('black','blue3','red3'),seg.len = .5,cex=.7)
quantile(AG$Rsq,c(.5,.025,.975))
hist(AG$Rsq)
# only with TC
quantile(AG$Rsq[f_tc],c(.5,.025,.975))
hist(AG$Rsq[f_tc])
# with more deaths
quantile(AG$Rsq[f_d],c(.5,.025,.975))
hist(AG$Rsq[f_d])
layout(matrix(1:2,1,2))
# par(mar = c(bottom, left, top, right)), default  c(5.1, 4.1, 4.1, 2.1).
par(mar = c(6,4,2,2))
##################################
errbar(x = 1:4,y = sum_tc[,1],yplus = sum_tc[,2],yminus = sum_tc[,3],
xaxt='n',bty='n',ylab = 'proportion with time change',col='blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.3,y = sum_tc_d[,1],yplus = sum_tc_d[,2],yminus = sum_tc_d[,3],
xaxt='n',bty='n',ylab = '',col='red3',errbar.col = 'red3',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t2$region,las=2)
legend('bottomright',legend = c('across all','where >5,000 deaths'),bty='n',
lwd=2,col=c('blue3','red3'),seg.len = .5,cex=.7)
##################################
errbar(x = 1:4,y = t3[,2],yplus = t3[,3],yminus = t3[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',
xlab = '',xlim = c(0.8,4.5),ylim = c(0,1))
errbar(x = 1:4+.2,y = t3_tc[,2],yplus = t3_tc[,3],yminus = t3_tc[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',col = 'blue3',errbar.col = 'blue3',
xlab = '',xlim = c(0.5,4.5),ylim = c(0,1),add=TRUE)
errbar(x = 1:4+.4,y = t3_d[,2],yplus = t3_d[,3],yminus = t3_d[,4],
xaxt='n',bty='n',ylab = 'R-square (adj.)',col = 'red3',errbar.col = 'red3',
xlab = '',xlim = c(0.5,4.5),ylim = c(0,1),add=TRUE)
axis(side = 1,at = 1:4,labels = t3$region,las=2)
legend('bottomright',legend = c('all','with time change','and >5,000 deaths'),bty='n',
lwd=2,col=c('black','blue3','red3'),seg.len = .5,cex=.7)
