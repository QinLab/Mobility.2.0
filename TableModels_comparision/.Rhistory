getwd()
source(file = '../../Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/date_input.r')
output_var <- c('country','change','oldR0','newR0',
'oldThres','newThres','t_change','DIC')
# for (date_num in 1:2){#length(dates_input)){
date_num = 1
date_week_finishing <-  as.Date(dates_input[date_num],format = '%Y-%m-%d')
output <- list()
# for (Mdata in c('A','G')){
Mdata = 'A'
res1 <-  file = paste0('../../Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/',
date_week_finishing,'_output_over_form_',Mdata,'.rds' )
res1 <-  readRDS( file = paste0('../../Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/',
date_week_finishing,'_output_over_form_',Mdata,'.rds' ) )
R2 <-  readRDS( file = paste0('../../Mobility.2.0.Save/Saved_file/FitModels/R0_beta_tD_Over/Rdata/',
date_week_finishing,'_output_over_form_',Mdata,'.rds' ) )
paste0('../../Mobility.2.0.Save/Saved_file/FitModels/R0_beta_tD_Over/Rdata/',
date_week_finishing,'_output_over_form_',Mdata,'.rds' )
library(knitr)
library(Hmisc)
library(EpiEstim)
library(zoo)
library(latex2exp)
opts_chunk$set(collapse = TRUE)
opts_chunk$set(fig.path='../../Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/figs/', fig.keep='high',
dev=c('png'), fig.width=9, fig.height=6, cache=FALSE,
tidy=FALSE, warning=FALSE, fig.show="asis"
)
source(file = '../../Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/date_input.r')
source(file = '../inputProcessing/date_input.r')
output_var <- c('country','change','oldR0','newR0',
'oldThres','newThres','t_change','DIC')
# for (date_num in 1:length(dates_input)){
date_num = 1
date_week_finishing <-  as.Date(dates_input[date_num],format = '%Y-%m-%d')
output <- list()
# for (Mdata in c('A','G')){
Mdata = 'A'
R1 <-  readRDS( file = paste0('../../Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/',
date_week_finishing,'_output_over_form_',Mdata,'.rds' ) )
R2 <-  readRDS( file = paste0('../../Mobility.2.0.Save/Saved_file/FitModels/R0_beta_tD_Over/Rdata/',
date_week_finishing,'_output_over_form_',Mdata,'.rds' ) )
# for (si in 1:2){
si=1
res1 <- R1[[si]]
res2 <- R2[[si]]
# table 1
n_country <- ncol(res1$R0s)
Tb1 <- data.frame(matrix(NA,n_country*2,length(output_var_T1)))
output_var_T1 <- c('country','change','oldR0','newR0',
'oldThres','newThres','t_change','DIC')
Tb1 <- data.frame(matrix(NA,n_country*2,length(output_var_T1)))
names(Tb1) <- output_var_T1
View(Tb1)
z=res1$R0s
View(z)
country_names <- colnames(res1$resMCMC$DIC)
country_names <- names(res1$resMCMC$DIC)
country_names
country_names <- names(res1$resMCMC$DIC)[1:n_country]
res1$resMCMC$DIC
Tb1[1:n_country,] <- cbind(country_names,'no',NA,res1$R0s[1,],NA,
res1$betas[1,],NA,res1$resMCMC$DIC[1:n_country])
View(Tb1)
Tb1[1:n_country,] <- cbind(country_names,'no',NA,round(res1$R0s[1,],digits = 1),NA,
round(res1$betas[1,],digits = 2),NA,
round(res1$resMCMC$DIC[1:n_country]))
View(Tb1)
Tb1[n_country+(1:n_country),] <- cbind(country_names,'no',round(res2$R0s[1,],digits = 1),
round(res2$R0s2[1,],digits = 1),
round(res2$betas[1,],digits = 2),
round(res2$betas2[1,],digits = 2),
round(res2$tchange[1,],digits = 2),
round(res2$resMCMC$DIC[1:n_country]))
View(Tb1)
Tb_best <- data.frame(matrix(NA,n_country,length(output_var_T1)))
names(Tb_best) <- output_var_T1
for (i in 1:n_country){
if(res1$resMCMC$DIC[i] < (5+res1$resMCMC$DIC[i])){
Tb_best[i,] <- Tb1[i,]
}else{
Tb_best[i,] <- Tb1[n_country+i,]
}
}
View(Tb_best)
Tb_best <- data.frame(matrix(NA,n_country,length(output_var_T1)))
names(Tb_best) <- output_var_T1
for (i in 1:n_country){
if(res1$resMCMC$DIC[i] < (0+res1$resMCMC$DIC[i])){
Tb_best[i,] <- Tb1[i,]
}else{
Tb_best[i,] <- Tb1[n_country+i,]
}
}
View(Tb_best)
View(Tb1)
Tb_best <- data.frame(matrix(NA,n_country,length(output_var_T1)))
names(Tb_best) <- output_var_T1
for (i in 1:n_country){
if(res1$resMCMC$DIC[i] < (0+res2$resMCMC$DIC[i])){
Tb_best[i,] <- Tb1[i,]
}else{
Tb_best[i,] <- Tb1[n_country+i,]
}
}
Tb_best <- data.frame(matrix(NA,n_country,length(output_var_T1)))
names(Tb_best) <- output_var_T1
for (i in 1:n_country){
if(res1$resMCMC$DIC[i] < (5+res2$resMCMC$DIC[i])){
Tb_best[i,] <- Tb1[i,]
}else{
Tb_best[i,] <- Tb1[n_country+i,]
}
}
Tb1[n_country+(1:n_country),] <- cbind(country_names,'yes',round(res2$R0s[1,],digits = 1),
round(res2$R0s2[1,],digits = 1),
round(res2$betas[1,],digits = 2),
round(res2$betas2[1,],digits = 2),
round(res2$tchange[1,],digits = 2),
round(res2$resMCMC$DIC[1:n_country]))
Tb_best <- data.frame(matrix(NA,n_country,length(output_var_T1)))
names(Tb_best) <- output_var_T1
for (i in 1:n_country){
if(res1$resMCMC$DIC[i] < (5+res2$resMCMC$DIC[i])){
Tb_best[i,] <- Tb1[i,]
}else{
Tb_best[i,] <- Tb1[n_country+i,]
}
}
Tb1[n_country+(1:n_country),] <- cbind(country_names,'yes',
paste0(round(res2$R0s[1,],digits = 1),
'95%CrI[',round(res2$R0s[2,],digits = 1),
';',round(res2$R0s[3,],digits = 1),']'),
round(res2$R0s2[1,],digits = 1),
round(res2$betas[1,],digits = 2),
round(res2$betas2[1,],digits = 2),
round(res2$tchange[1,],digits = 2),
round(res2$resMCMC$DIC[1:n_country]))
View(Tb1)
Tb1[n_country+(1:n_country),] <- cbind(country_names,'yes',
paste0(round(res2$R0s[1,],digits = 1),
' ; 95%CrI[',round(res2$R0s[2,],digits = 1),
';',round(res2$R0s[3,],digits = 1),']'),
round(res2$R0s2[1,],digits = 1),
round(res2$betas[1,],digits = 2),
round(res2$betas2[1,],digits = 2),
round(res2$tchange[1,],digits = 2),
round(res2$resMCMC$DIC[1:n_country]))
Tb1[1:n_country,] <- cbind(country_names,'no',NA,
paste0(round(res1$R0s[1,],digits = 1),
' ; 95%CrI[',round(res1$R0s[2,],digits = 1),
';',round(res1$R0s[3,],digits = 1),']'),
NA,
paste0(round(res1$R0s[1,],digits = 1),
' ; 95%CrI[',round(res1$R0s[2,],digits = 1),
';',round(res1$R0s[3,],digits = 1),']'),
NA,
round(res1$resMCMC$DIC[1:n_country]))
Tb1[n_country+(1:n_country),] <- cbind(country_names,'yes',
paste0(round(res2$R0s[1,],digits = 1),
' ; 95%CrI[',round(res2$R0s[2,],digits = 1),
';',round(res2$R0s[3,],digits = 1),']'),
rpaste0(round(res2$R0s2[1,],digits = 1),
' ; 95%CrI[',round(res2$R0s2[2,],digits = 1),
';',round(res2$R0s2[3,],digits = 1),']'),
paste0(round(res2$betas[1,],digits = 1),
' ; 95%CrI[',round(res2$betas[2,],digits = 1),
';',round(res2$betas[3,],digits = 1),']'),
paste0(round(res2$betas2[1,],digits = 1),
' ; 95%CrI[',round(res2$betas2[2,],digits = 1),
';',round(res2$betas2[3,],digits = 1),']'),
paste0(round(res2$tchange[1,],digits = 1),
' ; 95%CrI[',round(res2$tchange[2,],digits = 1),
';',round(res2$tchange[3,],digits = 1),']'),
round(res2$resMCMC$DIC[1:n_country]))
Tb1[n_country+(1:n_country),] <- cbind(country_names,'yes',
paste0(round(res2$R0s[1,],digits = 1),
' ; 95%CrI[',round(res2$R0s[2,],digits = 1),
';',round(res2$R0s[3,],digits = 1),']'),
paste0(round(res2$R0s2[1,],digits = 1),
' ; 95%CrI[',round(res2$R0s2[2,],digits = 1),
';',round(res2$R0s2[3,],digits = 1),']'),
paste0(round(res2$betas[1,],digits = 1),
' ; 95%CrI[',round(res2$betas[2,],digits = 1),
';',round(res2$betas[3,],digits = 1),']'),
paste0(round(res2$betas2[1,],digits = 1),
' ; 95%CrI[',round(res2$betas2[2,],digits = 1),
';',round(res2$betas2[3,],digits = 1),']'),
paste0(round(res2$tchange[1,],digits = 1),
' ; 95%CrI[',round(res2$tchange[2,],digits = 1),
';',round(res2$tchange[3,],digits = 1),']'),
round(res2$resMCMC$DIC[1:n_country]))
View(Tb_best)
Tb_best <- data.frame(matrix(NA,n_country,length(output_var_T1)))
names(Tb_best) <- output_var_T1
for (i in 1:n_country){
if(res1$resMCMC$DIC[i] < (5+res2$resMCMC$DIC[i])){
Tb_best[i,] <- Tb1[i,]
}else{
Tb_best[i,] <- Tb1[n_country+i,]
}
}
View(Tb_best)
View(Tb1)
getwd()
inputs<- readRDS(file=
'../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/inputs.rds')
names(inputs)
data_stream <- names(inputs$M_process_mat )
data_stream
DICs1 <- data.frame(country = names(inputs$D)[-1])
DICs1 <- data.frame(country = names(inputs$D)[-1],matrix(NA,1,length(data_stream)))
names(DICs1)[-1] <- data_stream
View(DICs1)
si=2
Mdata <- data_stream[1]
res_m <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
res_m2 <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_tD_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
si=2
res_m1 <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
res_m2 <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_tD_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
country_infer <- names(res_m1$resMCMC$DIC)
country_infer
which(names(DICs1) %in% Mdata))
Mdata
names(DICs1)
which(names(DICs1) %in% Mdata)
inputs<- readRDS(file=
'../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/inputs.rds')
names(inputs)
data_stream <- names(inputs$M_process_mat )
DICs1 <- data.frame(country = names(inputs$D)[-1],matrix(NA,1,length(data_stream)))
names(DICs1)[-1] <- data_stream
DICs2 <- DICs1
names(DICs1)[-1] <- paste0(data_stream,'_tc')
View(DICs1)
View(DICs2)
View(DICs1)
library(knitr)
library(Hmisc)
library(EpiEstim)
library(zoo)
library(latex2exp)
opts_chunk$set(collapse = TRUE)
opts_chunk$set(fig.path='../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/figs/', fig.keep='high',
dev=c('png'), fig.width=9, fig.height=6, cache=FALSE,
tidy=FALSE, warning=FALSE, fig.show="asis"
)
inputs<- readRDS(file=
'../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/inputs.rds')
names(inputs)
data_stream <- names(inputs$M_process_mat )
DICs1 <- data.frame(country = names(inputs$D)[-1],matrix(NA,1,length(data_stream)))
names(DICs1)[-1] <- data_stream
DICs2 <- DICs1
names(DICs2)[-1] <- paste0(data_stream,'_tc')
si=2
for (Mdata in data_stream){
res_m1 <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
res_m2 <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_tD_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
country_infer <- names(res_m1$resMCMC$DIC)
for (i in 1:length(country_infer)){
fc <- which(names(DICs1) %in% Mdata)
fr <- which(DICs1$country %in% country_infer[i])
DICs1[fr,fc] <- res_m1$resMCMC$DIC[i]
DICs2[fr,fc] <- res_m2$resMCMC$DIC[i]
}
}
DICs3 <- merge(x = DICs1,y = DICs2,by = DICs1$country)
View(DICs2)
View(DICs1)
Mdata
res_m1 <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
res_m2 <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_tD_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
res_m1$resMCMC$DIC
country_infer <- names(res_m1$resMCMC$DIC)
country_infer
names(res_m1$country)
(res_m1$country)
inputs<- readRDS(file=
'../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/inputs.rds')
names(inputs)
data_stream <- names(inputs$M_process_mat )
DICs1 <- data.frame(country = names(inputs$D)[-1],matrix(NA,1,length(data_stream)))
names(DICs1)[-1] <- data_stream
DICs2 <- DICs1
names(DICs2)[-1] <- paste0(data_stream,'_tc')
si=2
for (Mdata in data_stream){
res_m1 <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
res_m2 <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_tD_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
country_infer <- (res_m1$country)
for (i in 1:length(country_infer)){
fc <- which(names(DICs1) %in% Mdata)
fr <- which(DICs1$country %in% country_infer[i])
DICs1[fr,fc] <- res_m1$resMCMC$DIC[i]
DICs2[fr,fc] <- res_m2$resMCMC$DIC[i]
}
}
DICs3 <- merge(x = DICs1,y = DICs2,by = DICs1$country)
Mdata
for (Mdata in data_stream){
res_m1 <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
res_m2 <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_tD_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
country_infer <- (res_m1$country)
for (i in 1:length(country_infer)){
fc <- which(names(DICs1) %in% Mdata)
fr <- which(DICs1$country %in% country_infer[i])
DICs1[fr,fc] <- res_m1$resMCMC$DIC[i]
DICs2[fr,fc] <- res_m2$resMCMC$DIC[i]
}
}
View(DICs1)
View(DICs2)
DICs3 <- merge(x = DICs1,y = DICs2,by = list(DICs1$country))
DICs3 <- merge(x = DICs1,y = DICs2,by = country)
DICs3 <- merge(x = DICs1,y = DICs2,by = 'country')
write.csv(round(DICs1),file = 'DICs1.csv')
inputs<- readRDS(file=
'../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/inputs.rds')
names(inputs)
data_stream <- names(inputs$M_process_mat )
DICs1 <- data.frame(country = names(inputs$D)[-1],matrix(NA,1,length(data_stream)))
names(DICs1)[-1] <- data_stream
DICs2 <- DICs1
names(DICs2)[-1] <- paste0(data_stream,'_tc')
si=2
for (Mdata in data_stream){
res_m1 <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
res_m2 <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_tD_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
country_infer <- (res_m1$country)
for (i in 1:length(country_infer)){
fc <- which(names(DICs1) %in% Mdata)
fr <- which(DICs1$country %in% country_infer[i])
DICs1[fr,fc] <- round(res_m1$resMCMC$DIC[i])
DICs2[fr,fc] <- round(res_m2$resMCMC$DIC[i])
}
}
DICs3 <- merge(x = DICs1,y = DICs2,by = 'country')
DICs4 <- DICs3[,1:6]
names(DICs4)[-1] <- c('best','value','best_Tc','value','diff')
for (i in 1:nrow(DICs4)){
f <- which(DICs1[i,2:ncol(DICs1)] %in% min(DICs1[i,2:ncol(DICs1)],na.rm=TRUE))
DICs4[i,2] <- names(DICs1)[f+1]
DICs4[i,3] <- min(DICs1[i,2:ncol(DICs1)],na.rm=TRUE)
f <- which(DICs2[i,2:ncol(DICs1)] %in% min(DICs2[i,2:ncol(DICs1)],na.rm=TRUE))
DICs4[i,4] <- names(DICs2)[f+1]
DICs4[i,5] <- min(DICs2[i,2:ncol(DICs2)],na.rm=TRUE)
}
i
f <- which(DICs1[i,2:ncol(DICs1)] %in% min(DICs1[i,2:ncol(DICs1)],na.rm=TRUE))
f
DICs4[i,2] <- names(DICs1)[f+1]
DICs4[i,3] <- min(DICs1[i,2:ncol(DICs1)],na.rm=TRUE)
f <- which(DICs2[i,2:ncol(DICs1)] %in% min(DICs2[i,2:ncol(DICs1)],na.rm=TRUE))
f
library(knitr)
library(Hmisc)
library(EpiEstim)
library(zoo)
library(latex2exp)
opts_chunk$set(collapse = TRUE)
opts_chunk$set(fig.path='../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/figs/', fig.keep='high',
dev=c('png'), fig.width=9, fig.height=6, cache=FALSE,
tidy=FALSE, warning=FALSE, fig.show="asis"
)
inputs<- readRDS(file=
'../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/inputs.rds')
names(inputs)
data_stream <- names(inputs$M_process_mat )
DICs1 <- data.frame(country = names(inputs$D)[-1],matrix(NA,1,length(data_stream)))
names(DICs1)[-1] <- data_stream
DICs2 <- DICs1
names(DICs2)[-1] <- paste0(data_stream,'_tc')
si=2
for (Mdata in data_stream){
res_m1 <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
res_m2 <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_tD_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
country_infer <- (res_m1$country)
for (i in 1:length(country_infer)){
fc <- which(names(DICs1) %in% Mdata)
fr <- which(DICs1$country %in% country_infer[i])
DICs1[fr,fc] <- round(res_m1$resMCMC$DIC[i])
DICs2[fr,fc] <- round(res_m2$resMCMC$DIC[i])
}
}
DICs3 <- merge(x = DICs1,y = DICs2,by = 'country')
DICs4 <- DICs3[,1:6]
names(DICs4)[-1] <- c('best','value','best_Tc','value','diff')
for (i in 1:nrow(DICs4)){
f <- which(DICs1[i,2:ncol(DICs1)] %in% min(DICs1[i,2:ncol(DICs1)],na.rm=TRUE))
if(length(f)>1) f <- tail(f,1)
DICs4[i,2] <- names(DICs1)[f+1]
DICs4[i,3] <- min(DICs1[i,2:ncol(DICs1)],na.rm=TRUE)
f <- which(DICs2[i,2:ncol(DICs1)] %in% min(DICs2[i,2:ncol(DICs1)],na.rm=TRUE))
if(length(f)>1) f <- tail(f,1)
DICs4[i,4] <- names(DICs2)[f+1]
DICs4[i,5] <- min(DICs2[i,2:ncol(DICs2)],na.rm=TRUE)
}
DICs4[,6] <- DICs4[,3]-DICs4[,5]
write.csv(DICs1,file = 'DICs1.csv')
write.csv(DICs2,file = 'DICs2.csv')
write.csv(DICs3,file = 'DICs3.csv')
write.csv(DICs4,file = 'DICs4.csv')
View(DICs4)
