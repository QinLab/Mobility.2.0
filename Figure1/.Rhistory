# xlim=c(0,N_days),
col='blue',lwd=2)
polygon(c(res_summary2$results_full_Rt_D2$median_R$dates[f],
rev(res_summary2$results_full_Rt_D2$median_R$dates[f])),
c(res_summary2$results_full_Rt_D2$low_R[f,i+1],
rev(res_summary2$results_full_Rt_D2$up_R[f,i+1])),
col=rgb(0,0,1,.2), border = NA)
lines(res_summary2$results_full_Rt_daily$median_R$dates[f],
res_summary2$results_full_Rt_daily$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='red',lwd=2)
polygon(c(res_summary2$results_full_Rt_daily$median_R$dates[f],
rev(res_summary2$results_full_Rt_daily$median_R$dates[f])),
c(res_summary2$results_full_Rt_daily$low_R[f,i+1],
rev(res_summary2$results_full_Rt_daily$up_R[f,i+1])),
col=rgb(1,0,0,.2), border = NA)
}
if (Change == 1){
t_change <- quantile(res_m2$resMCMC$theta[,length(country)*4+i],c(0.5,.025,.975))
lines(inputs$D$dates[round(t_change[1])],5.5,type = 'p',pch=16,col='black')
lines(inputs$D$dates[round(t_change[2:3])],rep(5.5,2),lwd=1.5)
}
if (Change ==0){
legend('topleft',legend = c(TeX('R_t^{D}'),TeX('R_t'),TeX('R_t^{obs}')),
col = c(rgb(0,0,1),rgb(1,0,0),rgb(0,0,0)),lwd=2,bty='n',seg.len = .5)
}else{
legend('topleft',legend = c(TeX('R_t^{D}'),TeX('R_t'),TeX('R_t^{obs}'),TeX('t_{change}')),
col = c(rgb(0,0,1),rgb(1,0,0),rgb(0,0,0),rgb(0,0,0)),lwd=2,
pch = c(rep(NA,3),16),bty='n',seg.len = .5)
}
if (Change == 0){
f <- seq(4,nrow(res_base[[si]]$resEpi$S_below.5),by=7)
# f <- f[which(res_base[[si]]$resEpi$S_below.5[f,i+1])]
x <- 1-res_summary$results_meff$median_meff[f,i+1]-.5e-2
# x2 <- 1-res_summary2$results_meff$median_meff[f,i+1]-.5e-2
# plot(x1,x2)
# x <- (x1+x2)/ 2
y <- res_base[[si]]$resEpi$median_R[f,k+1]
yplus <- res_base[[si]]$resEpi$up_R[f,k+1]
yminus <- res_base[[si]]$resEpi$low_R[f,k+1]
n_est <- length(x)
##################
f <- which(inputs$D[,k+1] > 0)
plot(res_summary$results_full_Rt_assumed_mob$median_R$mobility,
res_summary$results_full_Rt_assumed_mob$median_R[ ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col=rgb(.1,.1,.1),lwd=2,
xlab = 'Prop. reduction in movement',
ylab = TeX('R_t'),yaxt="n",
xlim = c(min(c(x,0)),1),bty = 'n',
ylim = c((0),(6.5)))
mtext('c)', side = 3, line = -2, adj = -.05, cex = 1)
axis(side =2, at = (c(0,1,3,6)), labels = c(0,1,3,6))
abline(h=(1),lwd=2,col='darkolivegreen4',lty=2)
polygon(c(res_summary$results_full_Rt_assumed_mob$median_R$mobility,
rev(res_summary$results_full_Rt_assumed_mob$median_R$mobility)),
(c(res_summary$results_full_Rt_assumed_mob$low_R[,i+1],
rev(res_summary$results_full_Rt_assumed_mob$up_R[,i+1]))),
col=rgb(.1,.1,.1,.2),border=NA)
}
if (Change == 1){
f <- seq(4,nrow(res_base[[si]]$resEpi$S_below.5),by=7)
# f <- f[which(res_base[[si]]$resEpi$S_below.5[f,i+1])]
# x1 <- 1-res_summary$results_meff$median_meff[f,i+1]-.5e-2
x <- 1-res_summary2$results_meff$median_meff[f,i+1]-.5e-2
# plot(x1,x2)
# x <- (x1+x2)/ 2
y <- res_base[[si]]$resEpi$median_R[f,k+1]
yplus <- res_base[[si]]$resEpi$up_R[f,k+1]
yminus <- res_base[[si]]$resEpi$low_R[f,k+1]
n_est <- length(x)
##################
f <- which(inputs$D[,k+1] > 0)
plot(res_summary2$results_full_Rt_assumed_mob$median_R$mobility,
res_summary2$results_full_Rt_assumed_mob$median_R[ ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col=rgb(.4,.5,.1),lwd=2,
xlab = 'Prop. reduction in movement',
ylab = TeX('R_t'),yaxt="n",
xlim = c(min(c(x,0)),1),bty = 'n',
ylim = c((0.5),(6.5)))
mtext('c)', side = 3, line = -2, adj = -.05, cex = 1)
axis(side =2, at = (c(0,1,3,6)), labels = c(0,1,3,6))
abline(h=(1),lwd=2,col='darkolivegreen4',lty=2)
polygon(c(res_summary2$results_full_Rt_assumed_mob$median_R$mobility,
rev(res_summary2$results_full_Rt_assumed_mob$median_R$mobility)),
(c(res_summary2$results_full_Rt_assumed_mob$low_R[,i+1],
rev(res_summary2$results_full_Rt_assumed_mob$up_R[,i+1]))),
col=rgb(.4,.5,.1,.2),border=NA)
lines(res_summary2$results_full_Rt_assumed_mob2$median_R$mobility,
res_summary2$results_full_Rt_assumed_mob2$median_R[ ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col=rgb(.8,.3,0),lwd=2,
xlab = 'Prop. reduction in movement',
ylab = TeX('R_t'),yaxt="n",
xlim = c(0,1),bty = 'n',
ylim = c((0.5),(6.5)))
polygon(c(res_summary2$results_full_Rt_assumed_mob2$median_R$mobility,
rev(res_summary2$results_full_Rt_assumed_mob2$median_R$mobility)),
(c(res_summary2$results_full_Rt_assumed_mob2$low_R[,i+1],
rev(res_summary2$results_full_Rt_assumed_mob2$up_R[,i+1]))),
col=rgb(.8,.3,0,.2),border=NA)
}
# f2 <- range(1-res_summary$results_meff$median_meff[f,i+1])
# f3 <- which((res_summary$results_full_Rt_assumed_mob$median_R$mobility > f2[1]) &
#               (res_summary$results_full_Rt_assumed_mob$median_R$mobility < f2[2]))
# lines(res_summary$results_full_Rt_assumed_mob$median_R$mobility[f3],
#       res_summary$results_full_Rt_assumed_mob$median_R[f3,i+1],
#       type='l',#ylim = c(0,10),
#       # xlim=c(0,N_days),
#       col=rgb(1,0,1),lwd=2)
#
# polygon(c(res_summary$results_full_Rt_assumed_mob$median_R$mobility[f3],
#           rev(res_summary$results_full_Rt_assumed_mob$median_R$mobility[f3])),
#         (c(res_summary$results_full_Rt_assumed_mob$low_R[f3,i+1],
#            rev(res_summary$results_full_Rt_assumed_mob$up_R[f3,i+1]))),
#         col=rgb(1,0,1,.2),border=NA)
#epiestim see above
f <- seq(4,nrow(res_base[[si]]$resEpi$S_below.5),by=7)
# f <- f[which(res_base[[si]]$resEpi$S_below.5[f,i+1])]
# x1 <- 1-res_summary$results_meff$median_meff[f,i+1]-.5e-2
# x2 <- 1-res_summary2$results_meff$median_meff[f,i+1]-.5e-2
# # plot(x1,x2)
# x <- (x1+x2)/ 2
y <- res_base[[si]]$resEpi$median_R[f,k+1]
yplus <- res_base[[si]]$resEpi$up_R[f,k+1]
yminus <- res_base[[si]]$resEpi$low_R[f,k+1]
n_est <- length(x)
# if(Change == 0){
#   # f_new <-  n_est-round(as.numeric(substr(Tb_best$t_change[i], 1,2))/7)
#   errbar(x = x,
#          y = y,
#          yplus = yplus,
#          yminus = yminus,
#          col = c(rep(rgb(0,0,0),n_est-0),rep('red4',0)),
#          errbar.col = c(rep(rgb(0,0,0),n_est-0),rep('red4',0)),
#          add = TRUE)
#
#
#   legend('topright',legend = c(TeX('R_t predicted (with mobility)'),
#                                # TeX('R_t within range of observed mobility'),
#                                TeX('past R_t^{obs}')),
#          col = c(rgb(.4,.5,.1,.2),rgb(0,0,0)),lwd=2,bty='n')
# }else{
t_change
# plot new estimates
f <- which(res_summary$results_full_Rt_D2$median_R[,i+1] != 0)
if (Change==0){
lines(res_summary$results_full_Rt_D2$median_R$dates[f],
res_summary$results_full_Rt_D2$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='blue',lwd=2)
polygon(c(res_summary$results_full_Rt_D2$median_R$dates[f],
rev(res_summary$results_full_Rt_D2$median_R$dates[f])),
c(res_summary$results_full_Rt_D2$low_R[f,i+1],
rev(res_summary$results_full_Rt_D2$up_R[f,i+1])),
col=rgb(0,0,1,.2), border = NA)
lines(res_summary$results_full_Rt_daily$median_R$dates[f],
res_summary$results_full_Rt_daily$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='red',lwd=2)
polygon(c(res_summary$results_full_Rt_daily$median_R$dates[f],
rev(res_summary$results_full_Rt_daily$median_R$dates[f])),
c(res_summary$results_full_Rt_daily$low_R[f,i+1],
rev(res_summary$results_full_Rt_daily$up_R[f,i+1])),
col=rgb(1,0,0,.2), border = NA)
}else{
# second predictions
lines(res_summary2$results_full_Rt_D2$median_R$dates[f],
res_summary2$results_full_Rt_D2$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='blue',lwd=2)
polygon(c(res_summary2$results_full_Rt_D2$median_R$dates[f],
rev(res_summary2$results_full_Rt_D2$median_R$dates[f])),
c(res_summary2$results_full_Rt_D2$low_R[f,i+1],
rev(res_summary2$results_full_Rt_D2$up_R[f,i+1])),
col=rgb(0,0,1,.2), border = NA)
lines(res_summary2$results_full_Rt_daily$median_R$dates[f],
res_summary2$results_full_Rt_daily$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='red',lwd=2)
polygon(c(res_summary2$results_full_Rt_daily$median_R$dates[f],
rev(res_summary2$results_full_Rt_daily$median_R$dates[f])),
c(res_summary2$results_full_Rt_daily$low_R[f,i+1],
rev(res_summary2$results_full_Rt_daily$up_R[f,i+1])),
col=rgb(1,0,0,.2), border = NA)
}
# plot new estimates
f <- which(res_summary$results_full_Rt_D2$median_R[,i+1] != 0)
if (Change==0){
lines(res_summary$results_full_Rt_D2$median_R$dates[f],
res_summary$results_full_Rt_D2$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='blue',lwd=2)
polygon(c(res_summary$results_full_Rt_D2$median_R$dates[f],
rev(res_summary$results_full_Rt_D2$median_R$dates[f])),
c(res_summary$results_full_Rt_D2$low_R[f,i+1],
rev(res_summary$results_full_Rt_D2$up_R[f,i+1])),
col=rgb(0,0,1,.2), border = NA)
lines(res_summary$results_full_Rt_daily$median_R$dates[f],
res_summary$results_full_Rt_daily$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='red',lwd=2)
polygon(c(res_summary$results_full_Rt_daily$median_R$dates[f],
rev(res_summary$results_full_Rt_daily$median_R$dates[f])),
c(res_summary$results_full_Rt_daily$low_R[f,i+1],
rev(res_summary$results_full_Rt_daily$up_R[f,i+1])),
col=rgb(1,0,0,.2), border = NA)
}else{
# second predictions
lines(res_summary2$results_full_Rt_D2$median_R$dates[f],
res_summary2$results_full_Rt_D2$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='blue',lwd=2)
polygon(c(res_summary2$results_full_Rt_D2$median_R$dates[f],
rev(res_summary2$results_full_Rt_D2$median_R$dates[f])),
c(res_summary2$results_full_Rt_D2$low_R[f,i+1],
rev(res_summary2$results_full_Rt_D2$up_R[f,i+1])),
col=rgb(0,0,1,.2), border = NA)
lines(res_summary2$results_full_Rt_daily$median_R$dates[f],
res_summary2$results_full_Rt_daily$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='red',lwd=2)
polygon(c(res_summary2$results_full_Rt_daily$median_R$dates[f],
rev(res_summary2$results_full_Rt_daily$median_R$dates[f])),
c(res_summary2$results_full_Rt_daily$low_R[f,i+1],
rev(res_summary2$results_full_Rt_daily$up_R[f,i+1])),
col=rgb(1,0,0,.2), border = NA)
}
# plot Rt
f <- 1:nrow(res_base[[si]]$resEpi$S_below.5) #
# f <- f[which(res_base$resEpi$CV_below.2[,i+1])]
x <- res_base[[si]]$resEpi$median_R$dates[f] # (epi_res$t_end2 )[f]
plot(x,res_base[[si]]$resEpi$median_R[f,k+1],
xlim=xlim,
ylim = c(0,5),
type = 'l',col='black',lwd=2,bty = 'n',
# main =country[i],
xlab = '',ylab = TeX('R_t'))
mtext('b)', side = 3, line = 1.5, adj = -.15, cex = 1)
polygon(c(x,rev(x)),
c(res_base[[si]]$resEpi$low_R[f,k+1],rev(res_base[[si]]$resEpi$up_R[f,k+1])),
col = rgb(0,0,0,.2), border = FALSE )
abline(h=(1),lwd=2,col='darkolivegreen4',lty=2)
# plot new estimates
f <- which(res_summary$results_full_Rt_D2$median_R[,i+1] != 0)
if (Change==0){
lines(res_summary$results_full_Rt_D2$median_R$dates[f],
res_summary$results_full_Rt_D2$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='blue',lwd=2)
polygon(c(res_summary$results_full_Rt_D2$median_R$dates[f],
rev(res_summary$results_full_Rt_D2$median_R$dates[f])),
c(res_summary$results_full_Rt_D2$low_R[f,i+1],
rev(res_summary$results_full_Rt_D2$up_R[f,i+1])),
col=rgb(0,0,1,.2), border = NA)
lines(res_summary$results_full_Rt_daily$median_R$dates[f],
res_summary$results_full_Rt_daily$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='red',lwd=2)
polygon(c(res_summary$results_full_Rt_daily$median_R$dates[f],
rev(res_summary$results_full_Rt_daily$median_R$dates[f])),
c(res_summary$results_full_Rt_daily$low_R[f,i+1],
rev(res_summary$results_full_Rt_daily$up_R[f,i+1])),
col=rgb(1,0,0,.2), border = NA)
}else{
# second predictions
lines(res_summary2$results_full_Rt_D2$median_R$dates[f],
res_summary2$results_full_Rt_D2$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='blue',lwd=2)
polygon(c(res_summary2$results_full_Rt_D2$median_R$dates[f],
rev(res_summary2$results_full_Rt_D2$median_R$dates[f])),
c(res_summary2$results_full_Rt_D2$low_R[f,i+1],
rev(res_summary2$results_full_Rt_D2$up_R[f,i+1])),
col=rgb(0,0,1,.2), border = NA)
lines(res_summary2$results_full_Rt_daily$median_R$dates[f],
res_summary2$results_full_Rt_daily$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='red',lwd=2)
polygon(c(res_summary2$results_full_Rt_daily$median_R$dates[f],
rev(res_summary2$results_full_Rt_daily$median_R$dates[f])),
c(res_summary2$results_full_Rt_daily$low_R[f,i+1],
rev(res_summary2$results_full_Rt_daily$up_R[f,i+1])),
col=rgb(1,0,0,.2), border = NA)
}
# plot Rt
f <- 1:nrow(res_base[[si]]$resEpi$S_below.5) #
# f <- f[which(res_base$resEpi$CV_below.2[,i+1])]
x <- res_base[[si]]$resEpi$median_R$dates[f] # (epi_res$t_end2 )[f]
plot(x,res_base[[si]]$resEpi$median_R[f,k+1],
xlim=xlim,
ylim = c(0,5),
type = 'l',col='black',lwd=2,bty = 'n',
# main =country[i],
xlab = '',ylab = TeX('R_t'))
mtext('b)', side = 3, line = 1.5, adj = -.15, cex = 1)
polygon(c(x,rev(x)),
c(res_base[[si]]$resEpi$low_R[f,k+1],rev(res_base[[si]]$resEpi$up_R[f,k+1])),
col = rgb(0,0,0,.2), border = FALSE )
abline(h=(1),lwd=2,col='darkolivegreen4',lty=2)
# plot new estimates
f <- which(res_summary$results_full_Rt_D2$median_R[,i+1] != 0)
if (Change==0){
lines(res_summary$results_full_Rt_D2$median_R$dates[f],
res_summary$results_full_Rt_D2$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='blue',lwd=2)
polygon(c(res_summary$results_full_Rt_D2$median_R$dates[f],
rev(res_summary$results_full_Rt_D2$median_R$dates[f])),
c(res_summary$results_full_Rt_D2$low_R[f,i+1],
rev(res_summary$results_full_Rt_D2$up_R[f,i+1])),
col=rgb(0,0,1,.2), border = NA)
lines(res_summary$results_full_Rt_daily$median_R$dates[f],
res_summary$results_full_Rt_daily$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='red',lwd=2)
polygon(c(res_summary$results_full_Rt_daily$median_R$dates[f],
rev(res_summary$results_full_Rt_daily$median_R$dates[f])),
c(res_summary$results_full_Rt_daily$low_R[f,i+1],
rev(res_summary$results_full_Rt_daily$up_R[f,i+1])),
col=rgb(1,0,0,.2), border = NA)
}else{
# second predictions
lines(res_summary2$results_full_Rt_D2$median_R$dates[f],
res_summary2$results_full_Rt_D2$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='blue',lwd=2)
polygon(c(res_summary2$results_full_Rt_D2$median_R$dates[f],
rev(res_summary2$results_full_Rt_D2$median_R$dates[f])),
c(res_summary2$results_full_Rt_D2$low_R[f,i+1],
rev(res_summary2$results_full_Rt_D2$up_R[f,i+1])),
col=rgb(0,0,1,.2), border = NA)
lines(res_summary2$results_full_Rt_daily$median_R$dates[f],
res_summary2$results_full_Rt_daily$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='red',lwd=2)
polygon(c(res_summary2$results_full_Rt_daily$median_R$dates[f],
rev(res_summary2$results_full_Rt_daily$median_R$dates[f])),
c(res_summary2$results_full_Rt_daily$low_R[f,i+1],
rev(res_summary2$results_full_Rt_daily$up_R[f,i+1])),
col=rgb(1,0,0,.2), border = NA)
}
if (Change == 1){
t_change <- quantile(res_m2$resMCMC$theta[,length(country)*4+i],c(0.5,.025,.975))
lines(inputs$D$dates[round(t_change[1])],5.5,type = 'p',pch=16,col='black')
lines(inputs$D$dates[round(t_change[2:3])],rep(5.5,2),lwd=1.5)
}
# plot Rt
f <- 1:nrow(res_base[[si]]$resEpi$S_below.5) #
# f <- f[which(res_base$resEpi$CV_below.2[,i+1])]
x <- res_base[[si]]$resEpi$median_R$dates[f] # (epi_res$t_end2 )[f]
plot(x,res_base[[si]]$resEpi$median_R[f,k+1],
xlim=xlim,
ylim = c(0,5),
type = 'l',col='black',lwd=2,bty = 'n',
# main =country[i],
xlab = '',ylab = TeX('R_t'))
mtext('b)', side = 3, line = 1.5, adj = -.15, cex = 1)
polygon(c(x,rev(x)),
c(res_base[[si]]$resEpi$low_R[f,k+1],rev(res_base[[si]]$resEpi$up_R[f,k+1])),
col = rgb(0,0,0,.2), border = FALSE )
abline(h=(1),lwd=2,col='darkolivegreen4',lty=2)
# plot new estimates
f <- which(res_summary$results_full_Rt_D2$median_R[,i+1] != 0)
if (Change==0){
lines(res_summary$results_full_Rt_D2$median_R$dates[f],
res_summary$results_full_Rt_D2$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='blue',lwd=2)
polygon(c(res_summary$results_full_Rt_D2$median_R$dates[f],
rev(res_summary$results_full_Rt_D2$median_R$dates[f])),
c(res_summary$results_full_Rt_D2$low_R[f,i+1],
rev(res_summary$results_full_Rt_D2$up_R[f,i+1])),
col=rgb(0,0,1,.2), border = NA)
lines(res_summary$results_full_Rt_daily$median_R$dates[f],
res_summary$results_full_Rt_daily$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='red',lwd=2)
polygon(c(res_summary$results_full_Rt_daily$median_R$dates[f],
rev(res_summary$results_full_Rt_daily$median_R$dates[f])),
c(res_summary$results_full_Rt_daily$low_R[f,i+1],
rev(res_summary$results_full_Rt_daily$up_R[f,i+1])),
col=rgb(1,0,0,.2), border = NA)
}else{
# second predictions
lines(res_summary2$results_full_Rt_D2$median_R$dates[f],
res_summary2$results_full_Rt_D2$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='blue',lwd=2)
polygon(c(res_summary2$results_full_Rt_D2$median_R$dates[f],
rev(res_summary2$results_full_Rt_D2$median_R$dates[f])),
c(res_summary2$results_full_Rt_D2$low_R[f,i+1],
rev(res_summary2$results_full_Rt_D2$up_R[f,i+1])),
col=rgb(0,0,1,.2), border = NA)
lines(res_summary2$results_full_Rt_daily$median_R$dates[f],
res_summary2$results_full_Rt_daily$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='red',lwd=2)
polygon(c(res_summary2$results_full_Rt_daily$median_R$dates[f],
rev(res_summary2$results_full_Rt_daily$median_R$dates[f])),
c(res_summary2$results_full_Rt_daily$low_R[f,i+1],
rev(res_summary2$results_full_Rt_daily$up_R[f,i+1])),
col=rgb(1,0,0,.2), border = NA)
}
if (Change == 1){
t_change <- quantile(res_m2$resMCMC$theta[,length(country)*4+i],c(0.5,.025,.975))
lines(inputs$D$dates[round(t_change[1])],5,type = 'p',pch=16,col='darkorange')
lines(inputs$D$dates[round(t_change[2:3])],rep(5.5,2),lwd=1.5)
}
t_change
inputs$D$dates[round(t_change[2:3])]
# plot Rt
f <- 1:nrow(res_base[[si]]$resEpi$S_below.5) #
# f <- f[which(res_base$resEpi$CV_below.2[,i+1])]
x <- res_base[[si]]$resEpi$median_R$dates[f] # (epi_res$t_end2 )[f]
plot(x,res_base[[si]]$resEpi$median_R[f,k+1],
xlim=xlim,
ylim = c(0,5),
type = 'l',col='black',lwd=2,bty = 'n',
# main =country[i],
xlab = '',ylab = TeX('R_t'))
mtext('b)', side = 3, line = 1.5, adj = -.15, cex = 1)
polygon(c(x,rev(x)),
c(res_base[[si]]$resEpi$low_R[f,k+1],rev(res_base[[si]]$resEpi$up_R[f,k+1])),
col = rgb(0,0,0,.2), border = FALSE )
abline(h=(1),lwd=2,col='darkolivegreen4',lty=2)
# plot new estimates
f <- which(res_summary$results_full_Rt_D2$median_R[,i+1] != 0)
if (Change==0){
lines(res_summary$results_full_Rt_D2$median_R$dates[f],
res_summary$results_full_Rt_D2$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='blue',lwd=2)
polygon(c(res_summary$results_full_Rt_D2$median_R$dates[f],
rev(res_summary$results_full_Rt_D2$median_R$dates[f])),
c(res_summary$results_full_Rt_D2$low_R[f,i+1],
rev(res_summary$results_full_Rt_D2$up_R[f,i+1])),
col=rgb(0,0,1,.2), border = NA)
lines(res_summary$results_full_Rt_daily$median_R$dates[f],
res_summary$results_full_Rt_daily$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='red',lwd=2)
polygon(c(res_summary$results_full_Rt_daily$median_R$dates[f],
rev(res_summary$results_full_Rt_daily$median_R$dates[f])),
c(res_summary$results_full_Rt_daily$low_R[f,i+1],
rev(res_summary$results_full_Rt_daily$up_R[f,i+1])),
col=rgb(1,0,0,.2), border = NA)
}else{
# second predictions
lines(res_summary2$results_full_Rt_D2$median_R$dates[f],
res_summary2$results_full_Rt_D2$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='blue',lwd=2)
polygon(c(res_summary2$results_full_Rt_D2$median_R$dates[f],
rev(res_summary2$results_full_Rt_D2$median_R$dates[f])),
c(res_summary2$results_full_Rt_D2$low_R[f,i+1],
rev(res_summary2$results_full_Rt_D2$up_R[f,i+1])),
col=rgb(0,0,1,.2), border = NA)
lines(res_summary2$results_full_Rt_daily$median_R$dates[f],
res_summary2$results_full_Rt_daily$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='red',lwd=2)
polygon(c(res_summary2$results_full_Rt_daily$median_R$dates[f],
rev(res_summary2$results_full_Rt_daily$median_R$dates[f])),
c(res_summary2$results_full_Rt_daily$low_R[f,i+1],
rev(res_summary2$results_full_Rt_daily$up_R[f,i+1])),
col=rgb(1,0,0,.2), border = NA)
}
if (Change == 1){
t_change <- quantile(res_m2$resMCMC$theta[,length(country)*4+i],c(0.5,.025,.975))
lines(inputs$D$dates[round(t_change[1])],5,type = 'p',pch=16,col='darkorange')
lines(inputs$D$dates[round(t_change[2:3])],rep(5,2),lwd=1.5)
}
inputs$delta_id
sum(inputs$delta_id$dist*0:50)
mu_id = 18.8
allowed_change <- as.Date(c("2020-03-02","2020-04-06",
"2020-05-04","2020-06-01","2020-07-06"),
format = '%Y-%m-%d')
mu_id = 18.8
allowed_change_delay <- allowed_change - mu_id
allowed_change_delay
f
