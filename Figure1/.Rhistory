}
for (j in 1:rep){
R_daily <- Rt_fun(theta = res_m$resMCMC$theta[j,], x = M )
Rt_daily[,,j] <- R_daily
Rt_D2[,,j] <- H %*% R_daily
B <- rep(1,nrow(M)) %*% t(res_m$resMCMC$theta[j,(2-1)*N_geo+ (1:N_geo)])
m_eff[,,j] <- f_m_eff() # 1 + 1/B * log( inputs$H %*% exp( - B * (1-inputs$M) ) )
}
###################################
### assumed mobility
n_d <- 1e3
Rt_assumed_mob <- array(NA,dim = c(n_d,N_geo,rep))
x <-  matrix(seq(0,1,length.out = n_d),n_d,N_geo,byrow = FALSE)
for (j in 1:rep){
R_daily <- Rt_fun(theta = res_m$resMCMC$theta[j,], x = 1-x )
Rt_assumed_mob[,,j] <- R_daily
}
#####################################
## summaries
### Summary for Rt daily and Rt_D2
# format outputs
temp <- D
temp[,-1] <- NA
results_full_Rt_daily <- list(median_R = temp,
low_R = temp,
up_R = temp,
M = temp)
results_full_Rt_D2 <- list(median_R = temp,
low_R = temp,
up_R = temp,
M_D = temp)
results_meff <- list(median_meff = temp,
low_meff = temp,
up_meff = temp)
for (i in 1:N_geo){
temp <- apply(Rt_daily[,i,],1,quantile,c(.5,.025,.975),na.rm = TRUE)
results_full_Rt_daily$median_R[,i+1] <- temp[1,]
results_full_Rt_daily$low_R[,i+1] <- temp[2,]
results_full_Rt_daily$up_R[,i+1] <- temp[3,]
results_full_Rt_daily$M[,i+1] <- M[,i]
temp <- apply(Rt_D2[,i,],1,quantile,c(.5,.025,.975),na.rm = TRUE)
results_full_Rt_D2$median_R[,i+1] <- temp[1,]
results_full_Rt_D2$low_R[,i+1] <- temp[2,]
results_full_Rt_D2$up_R[,i+1] <- temp[3,]
# results_full_Rt_D2$M_D[,i+1] <- M_D[,i]
temp <- apply(m_eff[,i,],1,quantile,c(.5,.025,.975),na.rm = TRUE)
results_meff$median_meff[,i+1] <- temp[1,]
results_meff$low_meff[,i+1] <- temp[2,]
results_meff$up_meff[,i+1] <- temp[3,]
}
#############################################
### Summary for Rt assumed mobility
# format outputs
temp <- data.frame(matrix(NA,nrow = n_d, ncol = 1+N_geo))
temp[,1] <- x[,1]
names(temp) <- c('mobility', country)
results_full_Rt_assumed_mob <- list(median_R = temp,
low_R = temp,
up_R = temp)
Thresholds <- output[[si]]$R0s
f <- c()
for (i in 1:N_geo){
temp <- apply(Rt_assumed_mob[,i,],1,quantile,c(.5,.025,.975),na.rm = TRUE)
results_full_Rt_assumed_mob$median_R[,i+1] <- temp[1,]
results_full_Rt_assumed_mob$low_R[,i+1] <- temp[2,]
results_full_Rt_assumed_mob$up_R[,i+1] <- temp[3,]
f[1] <- which(results_full_Rt_assumed_mob$median_R[,i+1] < 1)[1]
f[2] <- which(results_full_Rt_assumed_mob$low_R[,i+1] < 1)[1]
f[3] <- which(results_full_Rt_assumed_mob$up_R[,i+1] < 1)[1]
for(j in 1:3){
if (is.na(f[j])){
Thresholds[j,i] <- NA
}else{
Thresholds[j,i] <- mean(results_full_Rt_assumed_mob$median_R$mobility[f[j]:(f[j]+1)])
}
}
}
output[[si]]$Thresholds <- Thresholds
output2[[si]] <- list(results_full_Rt_daily = results_full_Rt_daily,
results_full_Rt_D2 = results_full_Rt_D2,
results_meff = results_meff,
results_full_Rt_assumed_mob = results_full_Rt_assumed_mob)
# }
saveRDS(object = output,
file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output_over_form_',Mdata,'.rds' ))
saveRDS(object = output2,
file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output2_over_form_',Mdata,'.rds' ))
}
setwd('../Figure1')
library(knitr)
library(Hmisc)
library(EpiEstim)
library(zoo)
library(latex2exp)
opts_chunk$set(collapse = TRUE)
opts_chunk$set(fig.path='figs/', fig.keep='high',
dev=c('png'), fig.width=9, fig.height=6, cache=FALSE,
tidy=FALSE, warning=FALSE, fig.show="asis"
)
# source(file = '../inputProcessing/date_input.r')
source(file = 'Rscript/niceplot.R')
inputs<- readRDS(file=
'../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/inputs.rds')
names(inputs)
data_stream <- names(inputs$M_process_mat )
for(i in 1:length(data_stream)){
dir.create(path = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/figure1/figs/,',data_stream[i]))
}
inputs<- readRDS(file=
'../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/inputs.rds')
names(inputs)
data_stream <- names(inputs$M_process_mat )
for(i in 1:length(data_stream)){
dir.create(path = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/figure1/figs/',data_stream[i]))
}
inputs<- readRDS(file=
'../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/inputs.rds')
names(inputs)
data_stream <- names(inputs$M_process_mat )
for(i in 1:length(data_stream)){
dir.create(path = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/figure1/figs/',data_stream[i]))
}
res_base <- readRDS(file =
paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/EpiEstim/Rdata/output_EpiE.rds' ))
si <- 2
for (Mdata in c('A','G')){
# Mdata = data_stream[1]
res_m <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
res_summary <- readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output2_over_form_',Mdata,'.rds' ) )[[si]]
n_country <- length(res_m$country)
country <- res_m$country
country_initial <- names(inputs$D)[-1]
for (i in 1:n_country){
k <- which(country_initial %in% country[i])
Change <- 0
niceplot(i, res_summary, res_base, inputs)
}
}
inputs<- readRDS(file=
'../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/inputs.rds')
names(inputs)
data_stream <- names(inputs$M_process_mat )
for(i in 1:length(data_stream)){
dir.create(path = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/figure1/figs/',data_stream[i]))
}
res_base <- readRDS(file =
paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/EpiEstim/Rdata/output_EpiE.rds' ))
si <- 2
for (Mdata in data_stream){
# Mdata = data_stream[1]
res_m <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
res_summary <- readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output2_over_form_',Mdata,'.rds' ) )[[si]]
n_country <- length(res_m$country)
country <- res_m$country
country_initial <- names(inputs$D)[-1]
for (i in 1:n_country){
k <- which(country_initial %in% country[i])
Change <- 0
niceplot(i, res_summary, res_base, inputs)
}
}
i
Mdata
library(knitr)
library(Hmisc)
library(EpiEstim)
library(zoo)
library(latex2exp)
opts_chunk$set(collapse = TRUE)
opts_chunk$set(fig.path='figs/', fig.keep='high',
dev=c('png'), fig.width=9, fig.height=6, cache=FALSE,
tidy=FALSE, warning=FALSE, fig.show="asis"
)
# source(file = '../inputProcessing/date_input.r')
source(file = 'Rscript/niceplot.R')
inputs<- readRDS(file=
'../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/inputs.rds')
names(inputs)
data_stream <- names(inputs$M_process_mat )
# for(i in 1:length(data_stream)){
#   dir.create(path = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/figure1/figs/',data_stream[i]))
# }
res_base <- readRDS(file =
paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/EpiEstim/Rdata/output_EpiE.rds' ))
si <- 2
# for (Mdata in data_stream){
Mdata = data_stream[1]
res_m <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
res_summary <- readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output2_over_form_',Mdata,'.rds' ) )[[si]]
n_country <- length(res_m$country)
country <- res_m$country
country_initial <- names(inputs$D)[-1]
for (i in 1:n_country){
k <- which(country_initial %in% country[i])
Change <- 0
niceplot(i, res_summary, res_base, inputs)
}
n_country
country
i
k <- which(country_initial %in% country[i])
k
plot(inputs$D$dates,inputs$M_process_mat[[Mdata]][,k+1]/100,#main = country[i],
xlim = xlim,
ylim = c(0,max(c(1,inputs$M_process_mat[[Mdata]][,k+1]/100),na.rm=TRUE)),
xlab = '',ylab = 'prop. mobility',pch=16,bty = 'n')
lines(inputs$D$dates,inputs$M_process_mat[[Mdata]][,k+1]/100,col='darkorchid3',lwd=2)
# lines(mob3[,i+1],col='red')
abline(h=1,lwd=2,col='darkolivegreen4',lty=2)
mtext('a)', side = 3, line = 1.5, adj = -.15, cex = 1)
aa=inputs$M_process_mat[[Mdata]]
aa=inputs$D
library(knitr)
library(Hmisc)
library(EpiEstim)
library(zoo)
library(latex2exp)
opts_chunk$set(collapse = TRUE)
opts_chunk$set(fig.path='figs/', fig.keep='high',
dev=c('png'), fig.width=9, fig.height=6, cache=FALSE,
tidy=FALSE, warning=FALSE, fig.show="asis"
)
# source(file = '../inputProcessing/date_input.r')
source(file = 'Rscript/niceplot.R')
inputs<- readRDS(file=
'../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/inputs.rds')
names(inputs)
data_stream <- names(inputs$M_process_mat )
# for(i in 1:length(data_stream)){
#   dir.create(path = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/figure1/figs/',data_stream[i]))
# }
res_base <- readRDS(file =
paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/EpiEstim/Rdata/output_EpiE.rds' ))
si <- 2
# for (Mdata in data_stream){
Mdata = data_stream[1]
res_m <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
res_summary <- readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output2_over_form_',Mdata,'.rds' ) )[[si]]
n_country <- length(res_m$country)
country <- res_m$country
country_initial <- names(inputs$D)[-1]
for (i in 1:n_country){
k <- which(country_initial %in% country[i])
Change <- 0
niceplot(i, res_summary, res_base, inputs)
}
# }
k
f <- which(inputs$D[,k+1] > 0)
f
plot(res_summary$results_full_Rt_assumed_mob$median_R$mobility,
res_summary$results_full_Rt_assumed_mob$median_R[ ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col=rgb(.4,.5,.1),lwd=2,
xlab = 'Prop. reduction in movement',
ylab = TeX('R_t'),yaxt="n",
xlim = c(0,1),bty = 'n',
ylim = c((0.5),(6.5)))
f
#epiestim
f <- seq(4,nrow(res_base[[si]]$resEpi$S_below.5),by=7) #which(res_base$resEpi$CV_below.2[,i+1])
f
res_base[[si]]$resEpi$median_R[f,k+1]
f <- seq(4,nrow(res_base[[si]]$resEpi$S_below.5),by=7) #which(res_base$resEpi$CV_below.2[,i+1])
x <- 1-res_summary$results_meff$median_meff[f,i+1]-.5e-2
y <- res_base[[si]]$resEpi$median_R[f,k+1]
yplus <- res_base[[si]]$resEpi$up_R[f,k+1]
yminus <- res_base[[si]]$resEpi$low_R[f,k+1]
n_est <- length(x)
errbar(x = x,
y = y,
yplus = yplus,
yminus = yminus,
col = c(rep(rgb(0,0,0),n_est-0),rep('red4',0)),
errbar.col = c(rep(rgb(0,0,0),n_est-0),rep('red4',0)),
add = TRUE)
x
xlim <- c(as.Date('15-02-2020',format='%d-%m-%Y'),range(inputs$D$dates)[2])
layout(matrix(c(1,1,3,3,3,2,2,3,3,3),2,5,byrow = TRUE))
# plot mobility
plot(inputs$D$dates,inputs$M_process_mat[[Mdata]][,k]/100,#main = country[i],
xlim = xlim,
ylim = c(0,max(c(1,inputs$M_process_mat[[Mdata]][,k]/100),na.rm=TRUE)),
xlab = '',ylab = 'prop. mobility',pch=16,bty = 'n')
lines(inputs$D$dates,inputs$M_process_mat[[Mdata]][,k]/100,col='darkorchid3',lwd=2)
# lines(mob3[,i+1],col='red')
abline(h=1,lwd=2,col='darkolivegreen4',lty=2)
mtext('a)', side = 3, line = 1.5, adj = -.15, cex = 1)
# plot Rt
f <- 1:nrow(res_base[[si]]$resEpi$S_below.5) #which(res_base$resEpi$CV_below.2[,i+1])
x <- res_base[[si]]$resEpi$median_R$dates[f] # (epi_res$t_end2 )[f]
plot(x,res_base[[si]]$resEpi$median_R[f,k+1],
xlim=xlim,
ylim = c(0,5),
type = 'l',col='black',lwd=2,bty = 'n',
# main =country[i],
xlab = '',ylab = TeX('R_t'))
mtext('b)', side = 3, line = 1.5, adj = -.15, cex = 1)
polygon(c(x,rev(x)),
c(res_base[[si]]$resEpi$low_R[f,k+1],rev(res_base[[si]]$resEpi$up_R[f,k+1])),
col = rgb(0,0,0,.2), border = FALSE )
abline(h=(1),lwd=2,col='darkolivegreen4',lty=2)
# plot new estimates
f <- which(res_summary$results_full_Rt_D2$median_R[,i+1] != 0)
lines(res_summary$results_full_Rt_D2$median_R$dates[f],
res_summary$results_full_Rt_D2$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='blue',lwd=2)
polygon(c(res_summary$results_full_Rt_D2$median_R$dates[f],
rev(res_summary$results_full_Rt_D2$median_R$dates[f])),
c(res_summary$results_full_Rt_D2$low_R[f,i+1],
rev(res_summary$results_full_Rt_D2$up_R[f,i+1])),
col=rgb(0,0,1,.2), border = NA)
lines(res_summary$results_full_Rt_daily$median_R$dates[f],
res_summary$results_full_Rt_daily$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='red',lwd=2)
polygon(c(res_summary$results_full_Rt_daily$median_R$dates[f],
rev(res_summary$results_full_Rt_daily$median_R$dates[f])),
c(res_summary$results_full_Rt_daily$low_R[f,i+1],
rev(res_summary$results_full_Rt_daily$up_R[f,i+1])),
col=rgb(1,0,0,.2), border = NA)
if (Change == 1){
lines(inputs$D$dates[round(res_m$tchange[1,i])],5.5,type = 'p',pch=16,col='black')
lines(inputs$D$dates[round(res_m$tchange[2:3,i])],rep(5.5,2),lwd=1.5)
}
if (Change ==0){
legend('topleft',legend = c(TeX('R_t^{D}'),TeX('R_t'),TeX('R_t^{obs}')),
col = c(rgb(0,0,1),rgb(1,0,0),rgb(0,0,0)),lwd=2,bty='n',seg.len = .5)
}else{
legend('topleft',legend = c(TeX('R_t^{D}'),TeX('R_t'),TeX('R_t^{obs}'),TeX('t_{change}')),
col = c(rgb(0,0,1),rgb(1,0,0),rgb(0,0,0),rgb(0,0,0)),lwd=2,
pch = c(rep(NA,3),16),bty='n',seg.len = .5)
}
# plot Rt vs mob
f <- which(inputs$D[,k+1] > 0)
if (Change == 0){
plot(res_summary$results_full_Rt_assumed_mob$median_R$mobility,
res_summary$results_full_Rt_assumed_mob$median_R[ ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col=rgb(.4,.5,.1),lwd=2,
xlab = 'Prop. reduction in movement',
ylab = TeX('R_t'),yaxt="n",
xlim = c(-1,1),bty = 'n',
ylim = c((0.5),(6.5)))
mtext('c)', side = 3, line = -2, adj = -.05, cex = 1)
axis(side =2, at = (c(0,1,3,6)), labels = c(0,1,3,6))
abline(h=(1),lwd=2,col='darkolivegreen4',lty=2)
polygon(c(res_summary$results_full_Rt_assumed_mob$median_R$mobility,
rev(res_summary$results_full_Rt_assumed_mob$median_R$mobility)),
(c(res_summary$results_full_Rt_assumed_mob$low_R[,i+1],
rev(res_summary$results_full_Rt_assumed_mob$up_R[,i+1]))),
col=rgb(.4,.5,.1,.2),border=NA)
}
if (Change == 1){
plot(res_summary$results_full_Rt_assumed_mob$median_R$mobility,
res_summary$results_full_Rt_assumed_mob$median_R[ ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col=rgb(.8,.3,0),lwd=2,
xlab = 'Prop. reduction in movement',
ylab = TeX('R_t'),yaxt="n",
xlim = c(-1,1),bty = 'n',
ylim = c((0.5),(6.5)))
mtext('c)', side = 3, line = -2, adj = -.05, cex = 1)
axis(side =2, at = (c(0,1,3,6)), labels = c(0,1,3,6))
abline(h=(1),lwd=2,col='darkolivegreen4',lty=2)
polygon(c(res_summary$results_full_Rt_assumed_mob$median_R$mobility,
rev(res_summary$results_full_Rt_assumed_mob$median_R$mobility)),
(c(res_summary$results_full_Rt_assumed_mob$low_R[,i+1],
rev(res_summary$results_full_Rt_assumed_mob$up_R[,i+1]))),
col=rgb(.8,.3,0,.2),border=NA)
lines(res_summary$results_full_Rt_assumed_mob2$median_R$mobility,
res_summary$results_full_Rt_assumed_mob2$median_R[ ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col=rgb(.4,.5,.1),lwd=2,
xlab = 'Prop. reduction in movement',
ylab = TeX('R_t'),yaxt="n",
xlim = c(0,1),bty = 'n',
ylim = c((0.5),(6.5)))
polygon(c(res_summary$results_full_Rt_assumed_mob2$median_R$mobility,
rev(res_summary$results_full_Rt_assumed_mob2$median_R$mobility)),
(c(res_summary$results_full_Rt_assumed_mob2$low_R[,i+1],
rev(res_summary$results_full_Rt_assumed_mob2$up_R[,i+1]))),
col=rgb(.4,.5,.1,.2),border=NA)
}
# f2 <- range(1-res_summary$results_meff$median_meff[f,i+1])
# f3 <- which((res_summary$results_full_Rt_assumed_mob$median_R$mobility > f2[1]) &
#               (res_summary$results_full_Rt_assumed_mob$median_R$mobility < f2[2]))
# lines(res_summary$results_full_Rt_assumed_mob$median_R$mobility[f3],
#       res_summary$results_full_Rt_assumed_mob$median_R[f3,i+1],
#       type='l',#ylim = c(0,10),
#       # xlim=c(0,N_days),
#       col=rgb(1,0,1),lwd=2)
#
# polygon(c(res_summary$results_full_Rt_assumed_mob$median_R$mobility[f3],
#           rev(res_summary$results_full_Rt_assumed_mob$median_R$mobility[f3])),
#         (c(res_summary$results_full_Rt_assumed_mob$low_R[f3,i+1],
#            rev(res_summary$results_full_Rt_assumed_mob$up_R[f3,i+1]))),
#         col=rgb(1,0,1,.2),border=NA)
#epiestim
f <- seq(4,nrow(res_base[[si]]$resEpi$S_below.5),by=7) #which(res_base$resEpi$CV_below.2[,i+1])
x <- 1-res_summary$results_meff$median_meff[f,i+1]-.5e-2
y <- res_base[[si]]$resEpi$median_R[f,k+1]
yplus <- res_base[[si]]$resEpi$up_R[f,k+1]
yminus <- res_base[[si]]$resEpi$low_R[f,k+1]
n_est <- length(x)
if(Change == 0){
# f_new <-  n_est-round(as.numeric(substr(Tb_best$t_change[i], 1,2))/7)
errbar(x = x,
y = y,
yplus = yplus,
yminus = yminus,
col = c(rep(rgb(0,0,0),n_est-0),rep('red4',0)),
errbar.col = c(rep(rgb(0,0,0),n_est-0),rep('red4',0)),
add = TRUE)
legend('topright',legend = c(TeX('R_t predicted (with mobility)'),
# TeX('R_t within range of observed mobility'),
TeX('past R_t^{obs}')),
col = c(rgb(.4,.5,.1,.2),rgb(0,0,0)),lwd=2,bty='n')
}else{
f_new <-  n_est-round(as.numeric(substr(Tb_best$t_change[i], 1,3))/7)
errbar(x = x,
y = y,
yplus = yplus,
yminus = yminus,
col = c(rep(rgb(0,0,0),n_est-f_new),rep('red4',f_new)),
errbar.col = c(rep(rgb(0,0,0),n_est-f_new),rep('red4',f_new)),
add = TRUE)
legend('topright',legend = c(TeX('past R_t predicted (with mobility)'),
TeX('new R_t predicted (with mobility)'),
# TeX('R_t within range of observed mobility'),
TeX('past R_t^{obs}'),
TeX('past R_t^{obs} associated with new Th')),
col = c(rgb(.8,.3,0,.2),rgb(.4,.5,.1,.2),'black','red4'),lwd=2,bty='n')
}
# if(Mdata == 'A'){
mtext(paste0(country[i],' - ',Mdata), side = 3,  line = 1.5, outer = FALSE,adj = -.15,font=2)
library(knitr)
library(Hmisc)
library(EpiEstim)
library(zoo)
library(latex2exp)
opts_chunk$set(collapse = TRUE)
opts_chunk$set(fig.path='figs/', fig.keep='high',
dev=c('png'), fig.width=9, fig.height=6, cache=FALSE,
tidy=FALSE, warning=FALSE, fig.show="asis"
)
# source(file = '../inputProcessing/date_input.r')
source(file = 'Rscript/niceplot.R')
inputs<- readRDS(file=
'../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/inputs.rds')
names(inputs)
data_stream <- names(inputs$M_process_mat )
# for(i in 1:length(data_stream)){
#   dir.create(path = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/figure1/figs/',data_stream[i]))
# }
res_base <- readRDS(file =
paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/EpiEstim/Rdata/output_EpiE.rds' ))
si <- 2
# for (Mdata in data_stream){
Mdata = data_stream[1]
res_m <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
res_summary <- readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output2_over_form_',Mdata,'.rds' ) )[[si]]
n_country <- length(res_m$country)
country <- res_m$country
country_initial <- names(inputs$D)[-1]
for (i in 1:n_country){
k <- which(country_initial %in% country[i])
Change <- 0
niceplot(i, res_summary, res_base, inputs)
}
# }
library(knitr)
library(Hmisc)
library(EpiEstim)
library(zoo)
library(latex2exp)
opts_chunk$set(collapse = TRUE)
opts_chunk$set(fig.path='figs/', fig.keep='high',
dev=c('png'), fig.width=9, fig.height=6, cache=FALSE,
tidy=FALSE, warning=FALSE, fig.show="asis"
)
# source(file = '../inputProcessing/date_input.r')
source(file = 'Rscript/niceplot.R')
inputs<- readRDS(file=
'../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/inputs.rds')
names(inputs)
data_stream <- names(inputs$M_process_mat )
# for(i in 1:length(data_stream)){
#   dir.create(path = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/figure1/figs/',data_stream[i]))
# }
res_base <- readRDS(file =
paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/EpiEstim/Rdata/output_EpiE.rds' ))
Mdata = data_stream[1]
res_m <-  readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output_over_form_',Mdata,'.rds' ))[[si]]
res_summary <- readRDS( file = paste0('../../../../Dropbox (SPH Imperial College)/Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/output2_over_form_',Mdata,'.rds' ) )[[si]]
n_country <- length(res_m$country)
country <- res_m$country
country_initial <- names(inputs$D)[-1]
i=1
k <- which(country_initial %in% country[i])
#epiestim
f <- seq(4,nrow(res_base[[si]]$resEpi$S_below.5),by=7) #which(res_base$resEpi$CV_below.2[,i+1])
f
which(res_base$resEpi$CV_below.2[,i+1])
aa=res_summary$results_meff$median_meff
