add = TRUE)
legend('topright',legend = c(TeX('past R_t predicted (with mobility)'),
TeX('new R_t predicted (with mobility)'),
# TeX('R_t within range of observed mobility'),
TeX('past R_t^{obs}'),
TeX('past R_t^{obs} associated with new Th')),
col = c(rgb(.8,.3,0,.2),rgb(.4,.5,.1,.2),'black','red4'),lwd=2,bty='n')
}
i=1
if (Tb_best$change[i] == 'no'){
Change <- 0
res_summary <-  readRDS( file = paste0('../../Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/',
date_week_finishing,'_output2_over_form_',Mdata,'.rds' ) )[[si]]
}else{
Change <- 1
res_summary <-  readRDS( file = paste0('../../Mobility.2.0.Save/Saved_file/FitModels/R0_beta_tD_Over/Rdata/',
date_week_finishing,'_output2_over_form_',Mdata,'.rds' ) )[[si]]
}
Change
xlim <- c(as.Date('15-02-2020',format='%d-%m-%Y'),range(inputs$D$dates)[2])
layout(matrix(c(1,1,3,3,3,2,2,3,3,3),2,5,byrow = TRUE))
# plot mobility
plot(inputs$mob_raw$dates,inputs$mob_raw[,i+1],#main = country[i],
xlim = xlim,
ylim = c(0,max(c(1,inputs$mob_raw[,i+1]))),
xlab = '',ylab = 'prop. mobility',pch=16,bty = 'n')
lines(inputs$mob_raw$dates,inputs$M[,i],col='darkorchid3',lwd=2)
# lines(mob3[,i+1],col='red')
abline(h=1,lwd=2,col='darkolivegreen4',lty=2)
mtext('a)', side = 3, line = 1.5, adj = -.15, cex = 1)
# plot Rt
f <- 1:nrow(res_base[[si]]$resEpi$CV_below.2) #which(res_base$resEpi$CV_below.2[,i+1])
x <- res_base[[si]]$resEpi$median_R$dates[f] # (epi_res$t_end2 )[f]
plot(x,res_base[[si]]$resEpi$median_R[f,i+1],
xlim=xlim,
ylim = c(0,6),
type = 'l',col='black',lwd=2,bty = 'n',
# main =country[i],
xlab = '',ylab = TeX('R_t'))
mtext('b)', side = 3, line = 1.5, adj = -.15, cex = 1)
polygon(c(x,rev(x)),
c(res_base[[si]]$resEpi$low_R[f,i+1],rev(res_base[[si]]$resEpi$up_R[f,i+1])),
col = rgb(0,0,0,.2), border = FALSE )
abline(h=(1),lwd=2,col='darkolivegreen4',lty=2)
# plot new estimates
f <- which(res_summary$results_full_Rt_D2$median_R[,i+1] != 0)
lines(res_summary$results_full_Rt_D2$median_R$dates[f],
res_summary$results_full_Rt_D2$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='blue',lwd=2)
polygon(c(res_summary$results_full_Rt_D2$median_R$dates[f],
rev(res_summary$results_full_Rt_D2$median_R$dates[f])),
c(res_summary$results_full_Rt_D2$low_R[f,i+1],
rev(res_summary$results_full_Rt_D2$up_R[f,i+1])),
col=rgb(0,0,1,.2), border = NA)
lines(res_summary$results_full_Rt_daily$median_R$dates[f],
res_summary$results_full_Rt_daily$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='red',lwd=2)
polygon(c(res_summary$results_full_Rt_daily$median_R$dates[f],
rev(res_summary$results_full_Rt_daily$median_R$dates[f])),
c(res_summary$results_full_Rt_daily$low_R[f,i+1],
rev(res_summary$results_full_Rt_daily$up_R[f,i+1])),
col=rgb(1,0,0,.2), border = NA)
legend('topleft',legend = c(TeX('R_t^{D}'),TeX('R_t'),TeX('R_t^{obs}')),
col = c(rgb(0,0,1),rgb(1,0,0),rgb(0,0,0)),lwd=2,bty='n')
# plot Rt vs mob
f <- which(inputs$D[,i+1] > 0)
if (Change == 0){
plot(res_summary$results_full_Rt_assumed_mob$median_R$mobility,
res_summary$results_full_Rt_assumed_mob$median_R[ ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col=rgb(.4,.5,.1),lwd=2,
xlab = 'Prop. reduction in movement',
ylab = TeX('R_t'),yaxt="n",
xlim = c(0,1),bty = 'n',
ylim = c((0.5),(6.5)))
mtext('c)', side = 3, line = -2, adj = -.05, cex = 1)
axis(side =2, at = (c(0,1,3,6)), labels = c(0,1,3,6))
abline(h=(1),lwd=2,col='darkolivegreen4',lty=2)
polygon(c(res_summary$results_full_Rt_assumed_mob$median_R$mobility,
rev(res_summary$results_full_Rt_assumed_mob$median_R$mobility)),
(c(res_summary$results_full_Rt_assumed_mob$low_R[,i+1],
rev(res_summary$results_full_Rt_assumed_mob$up_R[,i+1]))),
col=rgb(.4,.5,.1),border=NA)
}
if (Change == 1){
plot(res_summary$results_full_Rt_assumed_mob$median_R$mobility,
res_summary$results_full_Rt_assumed_mob$median_R[ ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col=rgb(.8,.3,0),lwd=2,
xlab = 'Prop. reduction in movement',
ylab = TeX('R_t'),yaxt="n",
xlim = c(0,1),bty = 'n',
ylim = c((0.5),(6.5)))
mtext('c)', side = 3, line = -2, adj = -.05, cex = 1)
axis(side =2, at = (c(0,1,3,6)), labels = c(0,1,3,6))
abline(h=(1),lwd=2,col='darkolivegreen4',lty=2)
polygon(c(res_summary$results_full_Rt_assumed_mob$median_R$mobility,
rev(res_summary$results_full_Rt_assumed_mob$median_R$mobility)),
(c(res_summary$results_full_Rt_assumed_mob$low_R[,i+1],
rev(res_summary$results_full_Rt_assumed_mob$up_R[,i+1]))),
col=rgb(.8,.3,0,.2),border=NA)
lines(res_summary$results_full_Rt_assumed_mob2$median_R$mobility,
res_summary$results_full_Rt_assumed_mob2$median_R[ ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col=rgb(.4,.5,.1),lwd=2,
xlab = 'Prop. reduction in movement',
ylab = TeX('R_t'),yaxt="n",
xlim = c(0,1),bty = 'n',
ylim = c((0.5),(6.5)))
polygon(c(res_summary$results_full_Rt_assumed_mob2$median_R$mobility,
rev(res_summary$results_full_Rt_assumed_mob2$median_R$mobility)),
(c(res_summary$results_full_Rt_assumed_mob2$low_R[,i+1],
rev(res_summary$results_full_Rt_assumed_mob2$up_R[,i+1]))),
col=rgb(.4,.5,.1,.2),border=NA)
}
# f2 <- range(1-res_summary$results_meff$median_meff[f,i+1])
# f3 <- which((res_summary$results_full_Rt_assumed_mob$median_R$mobility > f2[1]) &
#               (res_summary$results_full_Rt_assumed_mob$median_R$mobility < f2[2]))
# lines(res_summary$results_full_Rt_assumed_mob$median_R$mobility[f3],
#       res_summary$results_full_Rt_assumed_mob$median_R[f3,i+1],
#       type='l',#ylim = c(0,10),
#       # xlim=c(0,N_days),
#       col=rgb(1,0,1),lwd=2)
#
# polygon(c(res_summary$results_full_Rt_assumed_mob$median_R$mobility[f3],
#           rev(res_summary$results_full_Rt_assumed_mob$median_R$mobility[f3])),
#         (c(res_summary$results_full_Rt_assumed_mob$low_R[f3,i+1],
#            rev(res_summary$results_full_Rt_assumed_mob$up_R[f3,i+1]))),
#         col=rgb(1,0,1,.2),border=NA)
#epiestim
f <- seq(4,nrow(res_base[[si]]$resEpi$CV_below.2),by=7) #which(res_base$resEpi$CV_below.2[,i+1])
x <- 1-res_summary$results_meff$median_meff[f,i+1]-.5e-2
y <- res_base[[si]]$resEpi$median_R[f,i+1]
yplus <- res_base[[si]]$resEpi$up_R[f,i+1]
yminus <- res_base[[si]]$resEpi$low_R[f,i+1]
n_est <- length(x)
if(Change == 0){
# f_new <-  n_est-round(as.numeric(substr(Tb_best$t_change[i], 1,2))/7)
errbar(x = x,
y = y,
yplus = yplus,
yminus = yminus,
col = c(rep(rgb(0,0,0),n_est-0),rep('red4',0)),
errbar.col = c(rep(rgb(0,0,0),n_est-0),rep('red4',0)),
add = TRUE)
legend('topright',legend = c(TeX('R_t predicted (with mobility)'),
# TeX('R_t within range of observed mobility'),
TeX('past R_t^{obs}')),
col = c(rgb(.4,.5,.1,.2),rgb(0,0,0)),lwd=2,bty='n')
}else{
f_new <-  n_est-round(as.numeric(substr(Tb_best$t_change[i], 1,2))/7)
errbar(x = x,
y = y,
yplus = yplus,
yminus = yminus,
col = c(rep(rgb(0,0,0),n_est-f_new),rep('red4',f_new)),
errbar.col = c(rep(rgb(0,0,0),n_est-f_new),rep('red4',f_new)),
add = TRUE)
legend('topright',legend = c(TeX('past R_t predicted (with mobility)'),
TeX('new R_t predicted (with mobility)'),
# TeX('R_t within range of observed mobility'),
TeX('past R_t^{obs}'),
TeX('past R_t^{obs} associated with new Th')),
col = c(rgb(.8,.3,0,.2),rgb(.4,.5,.1,.2),'black','red4'),lwd=2,bty='n')
}
xlim <- c(as.Date('15-02-2020',format='%d-%m-%Y'),range(inputs$D$dates)[2])
layout(matrix(c(1,1,3,3,3,2,2,3,3,3),2,5,byrow = TRUE))
# plot mobility
plot(inputs$mob_raw$dates,inputs$mob_raw[,i+1],#main = country[i],
xlim = xlim,
ylim = c(0,max(c(1,inputs$mob_raw[,i+1]))),
xlab = '',ylab = 'prop. mobility',pch=16,bty = 'n')
lines(inputs$mob_raw$dates,inputs$M[,i],col='darkorchid3',lwd=2)
# lines(mob3[,i+1],col='red')
abline(h=1,lwd=2,col='darkolivegreen4',lty=2)
mtext('a)', side = 3, line = 1.5, adj = -.15, cex = 1)
# plot Rt
f <- 1:nrow(res_base[[si]]$resEpi$CV_below.2) #which(res_base$resEpi$CV_below.2[,i+1])
x <- res_base[[si]]$resEpi$median_R$dates[f] # (epi_res$t_end2 )[f]
plot(x,res_base[[si]]$resEpi$median_R[f,i+1],
xlim=xlim,
ylim = c(0,6),
type = 'l',col='black',lwd=2,bty = 'n',
# main =country[i],
xlab = '',ylab = TeX('R_t'))
mtext('b)', side = 3, line = 1.5, adj = -.15, cex = 1)
polygon(c(x,rev(x)),
c(res_base[[si]]$resEpi$low_R[f,i+1],rev(res_base[[si]]$resEpi$up_R[f,i+1])),
col = rgb(0,0,0,.2), border = FALSE )
abline(h=(1),lwd=2,col='darkolivegreen4',lty=2)
# plot new estimates
f <- which(res_summary$results_full_Rt_D2$median_R[,i+1] != 0)
lines(res_summary$results_full_Rt_D2$median_R$dates[f],
res_summary$results_full_Rt_D2$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='blue',lwd=2)
polygon(c(res_summary$results_full_Rt_D2$median_R$dates[f],
rev(res_summary$results_full_Rt_D2$median_R$dates[f])),
c(res_summary$results_full_Rt_D2$low_R[f,i+1],
rev(res_summary$results_full_Rt_D2$up_R[f,i+1])),
col=rgb(0,0,1,.2), border = NA)
lines(res_summary$results_full_Rt_daily$median_R$dates[f],
res_summary$results_full_Rt_daily$median_R[f ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col='red',lwd=2)
polygon(c(res_summary$results_full_Rt_daily$median_R$dates[f],
rev(res_summary$results_full_Rt_daily$median_R$dates[f])),
c(res_summary$results_full_Rt_daily$low_R[f,i+1],
rev(res_summary$results_full_Rt_daily$up_R[f,i+1])),
col=rgb(1,0,0,.2), border = NA)
legend('topleft',legend = c(TeX('R_t^{D}'),TeX('R_t'),TeX('R_t^{obs}')),
col = c(rgb(0,0,1),rgb(1,0,0),rgb(0,0,0)),lwd=2,bty='n')
# plot Rt vs mob
f <- which(inputs$D[,i+1] > 0)
if (Change == 0){
plot(res_summary$results_full_Rt_assumed_mob$median_R$mobility,
res_summary$results_full_Rt_assumed_mob$median_R[ ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col=rgb(.4,.5,.1),lwd=2,
xlab = 'Prop. reduction in movement',
ylab = TeX('R_t'),yaxt="n",
xlim = c(0,1),bty = 'n',
ylim = c((0.5),(6.5)))
mtext('c)', side = 3, line = -2, adj = -.05, cex = 1)
axis(side =2, at = (c(0,1,3,6)), labels = c(0,1,3,6))
abline(h=(1),lwd=2,col='darkolivegreen4',lty=2)
polygon(c(res_summary$results_full_Rt_assumed_mob$median_R$mobility,
rev(res_summary$results_full_Rt_assumed_mob$median_R$mobility)),
(c(res_summary$results_full_Rt_assumed_mob$low_R[,i+1],
rev(res_summary$results_full_Rt_assumed_mob$up_R[,i+1]))),
col=rgb(.4,.5,.1,.2),border=NA)
}
if (Change == 1){
plot(res_summary$results_full_Rt_assumed_mob$median_R$mobility,
res_summary$results_full_Rt_assumed_mob$median_R[ ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col=rgb(.8,.3,0),lwd=2,
xlab = 'Prop. reduction in movement',
ylab = TeX('R_t'),yaxt="n",
xlim = c(0,1),bty = 'n',
ylim = c((0.5),(6.5)))
mtext('c)', side = 3, line = -2, adj = -.05, cex = 1)
axis(side =2, at = (c(0,1,3,6)), labels = c(0,1,3,6))
abline(h=(1),lwd=2,col='darkolivegreen4',lty=2)
polygon(c(res_summary$results_full_Rt_assumed_mob$median_R$mobility,
rev(res_summary$results_full_Rt_assumed_mob$median_R$mobility)),
(c(res_summary$results_full_Rt_assumed_mob$low_R[,i+1],
rev(res_summary$results_full_Rt_assumed_mob$up_R[,i+1]))),
col=rgb(.8,.3,0,.2),border=NA)
lines(res_summary$results_full_Rt_assumed_mob2$median_R$mobility,
res_summary$results_full_Rt_assumed_mob2$median_R[ ,i+1],
type='l',#ylim = c(0,10),
# xlim=c(0,N_days),
col=rgb(.4,.5,.1),lwd=2,
xlab = 'Prop. reduction in movement',
ylab = TeX('R_t'),yaxt="n",
xlim = c(0,1),bty = 'n',
ylim = c((0.5),(6.5)))
polygon(c(res_summary$results_full_Rt_assumed_mob2$median_R$mobility,
rev(res_summary$results_full_Rt_assumed_mob2$median_R$mobility)),
(c(res_summary$results_full_Rt_assumed_mob2$low_R[,i+1],
rev(res_summary$results_full_Rt_assumed_mob2$up_R[,i+1]))),
col=rgb(.4,.5,.1,.2),border=NA)
}
# f2 <- range(1-res_summary$results_meff$median_meff[f,i+1])
# f3 <- which((res_summary$results_full_Rt_assumed_mob$median_R$mobility > f2[1]) &
#               (res_summary$results_full_Rt_assumed_mob$median_R$mobility < f2[2]))
# lines(res_summary$results_full_Rt_assumed_mob$median_R$mobility[f3],
#       res_summary$results_full_Rt_assumed_mob$median_R[f3,i+1],
#       type='l',#ylim = c(0,10),
#       # xlim=c(0,N_days),
#       col=rgb(1,0,1),lwd=2)
#
# polygon(c(res_summary$results_full_Rt_assumed_mob$median_R$mobility[f3],
#           rev(res_summary$results_full_Rt_assumed_mob$median_R$mobility[f3])),
#         (c(res_summary$results_full_Rt_assumed_mob$low_R[f3,i+1],
#            rev(res_summary$results_full_Rt_assumed_mob$up_R[f3,i+1]))),
#         col=rgb(1,0,1,.2),border=NA)
#epiestim
f <- seq(4,nrow(res_base[[si]]$resEpi$CV_below.2),by=7) #which(res_base$resEpi$CV_below.2[,i+1])
x <- 1-res_summary$results_meff$median_meff[f,i+1]-.5e-2
y <- res_base[[si]]$resEpi$median_R[f,i+1]
yplus <- res_base[[si]]$resEpi$up_R[f,i+1]
yminus <- res_base[[si]]$resEpi$low_R[f,i+1]
n_est <- length(x)
if(Change == 0){
# f_new <-  n_est-round(as.numeric(substr(Tb_best$t_change[i], 1,2))/7)
errbar(x = x,
y = y,
yplus = yplus,
yminus = yminus,
col = c(rep(rgb(0,0,0),n_est-0),rep('red4',0)),
errbar.col = c(rep(rgb(0,0,0),n_est-0),rep('red4',0)),
add = TRUE)
legend('topright',legend = c(TeX('R_t predicted (with mobility)'),
# TeX('R_t within range of observed mobility'),
TeX('past R_t^{obs}')),
col = c(rgb(.4,.5,.1,.2),rgb(0,0,0)),lwd=2,bty='n')
}else{
f_new <-  n_est-round(as.numeric(substr(Tb_best$t_change[i], 1,2))/7)
errbar(x = x,
y = y,
yplus = yplus,
yminus = yminus,
col = c(rep(rgb(0,0,0),n_est-f_new),rep('red4',f_new)),
errbar.col = c(rep(rgb(0,0,0),n_est-f_new),rep('red4',f_new)),
add = TRUE)
legend('topright',legend = c(TeX('past R_t predicted (with mobility)'),
TeX('new R_t predicted (with mobility)'),
# TeX('R_t within range of observed mobility'),
TeX('past R_t^{obs}'),
TeX('past R_t^{obs} associated with new Th')),
col = c(rgb(.8,.3,0,.2),rgb(.4,.5,.1,.2),'black','red4'),lwd=2,bty='n')
}
fig.name=paste0('../../Mobility.2.0.Save/Saved_file/figure1/figs/',date_week_finishing,'/',country[i],'_SI_',si_num,'.png')
fig.name=paste0('../../Mobility.2.0.Save/Saved_file/figure1/figs/',date_week_finishing,'/',country[i],'_SI_',si,'.png')
fig.name
getwd()
date_week_finishing
library(knitr)
library(Hmisc)
library(EpiEstim)
library(zoo)
library(latex2exp)
opts_chunk$set(collapse = TRUE)
opts_chunk$set(fig.path='figs/', fig.keep='high',
dev=c('png'), fig.width=9, fig.height=6, cache=FALSE,
tidy=FALSE, warning=FALSE, fig.show="asis"
)
source(file = '../inputProcessing/date_input.r')
source(file = 'Rscript/niceplot.R')
library(knitr)
library(Hmisc)
library(EpiEstim)
library(zoo)
library(latex2exp)
opts_chunk$set(collapse = TRUE)
opts_chunk$set(fig.path='figs/', fig.keep='high',
dev=c('png'), fig.width=9, fig.height=6, cache=FALSE,
tidy=FALSE, warning=FALSE, fig.show="asis"
)
source(file = '../inputProcessing/date_input.r')
source(file = 'Rscript/niceplot.R')
# for (date_num in length(dates_input)){
date_num = length(dates_input)
date_week_finishing <-  as.Date(dates_input[date_num],format = '%Y-%m-%d')
si <- 2
for (Mdata in c('A','G')){
# Mdata = 'A'
inputs<- readRDS(file=paste0(
'../../Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/',
date_week_finishing,'_inputs_from_',Mdata,'.rds'))
res_base <- readRDS(file=paste0(
'../../Mobility.2.0.Save/Saved_file/EpiEstim/Rdata/',
date_week_finishing,'_output_from_',Mdata,'.rds'))
Tb_best <- readRDS(file = paste0('../../Mobility.2.0.Save/Saved_file/TableModels_comparision/RData/',
date_week_finishing,'_output_over_form_',Mdata,'.rds' ))$Tb_best
n_country <- nrow(Tb_best)
country <- Tb_best$country
for (i in 1:n_country){
# i=1
if (Tb_best$change[i] == 'no'){
Change <- 0
res_summary <-  readRDS( file = paste0('../../Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/',
date_week_finishing,'_output2_over_form_',Mdata,'.rds' ) )[[si]]
}else{
Change <- 1
res_summary <-  readRDS( file = paste0('../../Mobility.2.0.Save/Saved_file/FitModels/R0_beta_tD_Over/Rdata/',
date_week_finishing,'_output2_over_form_',Mdata,'.rds' ) )[[si]]
}
}
}
View(niceplot)
fig.name
fig.name=paste0('../../Mobility.2.0.Save/Saved_file/figure1/figs/',date_week_finishing,'/',country[i],'_M_',Mdata,'.png')
fig.name
library(knitr)
library(Hmisc)
library(EpiEstim)
library(zoo)
library(latex2exp)
opts_chunk$set(collapse = TRUE)
opts_chunk$set(fig.path='figs/', fig.keep='high',
dev=c('png'), fig.width=9, fig.height=6, cache=FALSE,
tidy=FALSE, warning=FALSE, fig.show="asis"
)
source(file = '../inputProcessing/date_input.r')
source(file = 'Rscript/niceplot.R')
# for (date_num in length(dates_input)){
date_num = length(dates_input)
date_week_finishing <-  as.Date(dates_input[date_num],format = '%Y-%m-%d')
si <- 2
for (Mdata in c('A','G')){
# Mdata = 'A'
inputs<- readRDS(file=paste0(
'../../Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/',
date_week_finishing,'_inputs_from_',Mdata,'.rds'))
res_base <- readRDS(file=paste0(
'../../Mobility.2.0.Save/Saved_file/EpiEstim/Rdata/',
date_week_finishing,'_output_from_',Mdata,'.rds'))
Tb_best <- readRDS(file = paste0('../../Mobility.2.0.Save/Saved_file/TableModels_comparision/RData/',
date_week_finishing,'_output_over_form_',Mdata,'.rds' ))$Tb_best
n_country <- nrow(Tb_best)
country <- Tb_best$country
for (i in 1:n_country){
# i=1
if (Tb_best$change[i] == 'no'){
Change <- 0
res_summary <-  readRDS( file = paste0('../../Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/',
date_week_finishing,'_output2_over_form_',Mdata,'.rds' ) )[[si]]
}else{
Change <- 1
res_summary <-  readRDS( file = paste0('../../Mobility.2.0.Save/Saved_file/FitModels/R0_beta_tD_Over/Rdata/',
date_week_finishing,'_output2_over_form_',Mdata,'.rds' ) )[[si]]
}
niceplot(i, res_summary, res_base)
}
}
Mdata
si
inputs<- readRDS(file=paste0(
'../../Mobility.2.0.Save/Saved_file/inputProcessing/Rdata/',
date_week_finishing,'_inputs_from_',Mdata,'.rds'))
res_base <- readRDS(file=paste0(
'../../Mobility.2.0.Save/Saved_file/EpiEstim/Rdata/',
date_week_finishing,'_output_from_',Mdata,'.rds'))
Tb_best <- readRDS(file = paste0('../../Mobility.2.0.Save/Saved_file/TableModels_comparision/RData/',
date_week_finishing,'_output_over_form_',Mdata,'.rds' ))$Tb_best
n_country <- nrow(Tb_best)
country <- Tb_best$country
for (i in 1:n_country){
# i=1
if (Tb_best$change[i] == 'no'){
Change <- 0
res_summary <-  readRDS( file = paste0('../../Mobility.2.0.Save/Saved_file/FitModels/R0_beta_Over/Rdata/',
date_week_finishing,'_output2_over_form_',Mdata,'.rds' ) )[[si]]
}else{
Change <- 1
res_summary <-  readRDS( file = paste0('../../Mobility.2.0.Save/Saved_file/FitModels/R0_beta_tD_Over/Rdata/',
date_week_finishing,'_output2_over_form_',Mdata,'.rds' ) )[[si]]
}
niceplot(i, res_summary, res_base)
}
library(knitr)
library(Hmisc)
library(EpiEstim)
library(zoo)
library(latex2exp)
library(tidyr)
opts_chunk$set(collapse = TRUE)
path_s <- '../../Mobility.2.0.Save/Saved_file/'
opts_chunk$set(fig.path=paste0(path_s,'inputs/figs/'), fig.keep='high',
dev=c('png'), fig.width=9, fig.height=6, cache=FALSE,
tidy=FALSE, warning=FALSE, fig.show="asis"
)
d_m <- read.csv(file=paste0(path_s,'inputs/applemobilitytrends-2020-05-16.csv'),
stringsAsFactors = FALSE)
path_s
d_m <- read.csv(file=paste0(path_s,'inputs/applemobilitytrends-2020-07-18.csv'),
stringsAsFactors = FALSE)
d_g <- read.csv(file=paste0(path_s,'inputs/Global_Mobility_Report.csv'),
stringsAsFactors = FALSE)
d_g <- d_g[ which(d_g$sub_region_1 == ''),]
##
a <- tidyr::gather(d_g, var,
val,
`retail_and_recreation_percent_change_from_baseline`:
`residential_percent_change_from_baseline`)
b <- tidyr::spread(a, date, val)
b <- b[,-which(names(b) %in% c("sub_region_1","sub_region_2" ))]
b <- b[-which(b$var %in% c('grocery_and_pharmacy_percent_change_from_baseline',
'parks_percent_change_from_baseline',
'residential_percent_change_from_baseline')) , ]
names(b)[1:3] <- names(d_m)[1:3]
b[,-c(1:3)] <- b[,-c(1:3)]+100
View(b)
View(d_g)
d_g <- read.csv(file=paste0(path_s,'inputs/Global_Mobility_Report.csv'),
stringsAsFactors = FALSE)
d_g <- d_g[ which(d_g$sub_region_1 == ''),]
##
a <- tidyr::gather(d_g, var,
val,
`retail_and_recreation_percent_change_from_baseline`:
`residential_percent_change_from_baseline`)
b <- tidyr::spread(a, date, val)
View(b)
names(b)
b <- tidyr::spread(a, date, val)
b <- b[,-which(names(b) %in% c("sub_region_1","sub_region_2" ,'iso_3166_2_code','census_fips_code'))]
b <- b[-which(b$var %in% c('grocery_and_pharmacy_percent_change_from_baseline',
'parks_percent_change_from_baseline',
'residential_percent_change_from_baseline')) , ]
names(d_m)[1:3]
names(b)[1:3] <- names(d_m)[1:3]
b[,-c(1:3)] <- b[,-c(1:3)]+100
names(b)[-c(1:3)] <- sub(x=paste0('X',sub(x =names(b)[-c(1:3)],pattern = '-',replacement = '.')),
pattern = '-',replacement = '.')
d_g <- b
d_g <- d_g[,-which(names(d_g) %in% c('X2020.02.15','X2020.02.16'))]
range(d_g[,-c(1:3)],na.rm=TRUE)
